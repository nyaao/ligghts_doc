# dump image command
# dump movie command

# 構文
```
dump ID group-ID style N file color diameter keyword value ...
```
- ID = ダンプのためにユーザーが割り当てた名前
- group-ID = イメージングする原子のグループID
- style = image または movie = ダンプコマンドのスタイル（他のスタイルとしては atom、cfg、dcd、xtc、- - xyz、local、custom がダンプのドキュメントページで説明されています）
- N = このステップ数ごとにダンプを実行
- file = イメージを保存するファイルの名前
- color = 各原子の色を決定する原子属性
- diameter = 各原子のサイズを決定する原子属性
- ゼロ個以上のキーワード/値のペアを追加することができます
- keyword = adiam、atom、bond、size、view、center、up、zoom、persp、box、axes、shiny、ssao

adiam 値 = 数値 = 原子の直径の数値（距離単位）  
atom = yes/no = 原子を描画するかしないか  
bond 値 = color width = 結合の色と幅  
color = atom または type または none  
width = number または atom または type または none  
number = 結合幅の数値（距離単位）  
size 値 = width height = 画像のサイズ  
width = 画像の幅（ピクセル数）  
height = 画像の高さ（ピクセル数）  
view 値 = theta phi = シミュレーションボックスの視点  
theta = +z軸からの視点角度（度）  
phi = 方位角（度）  
theta または phi は変数で指定できます（下記参照）  
center 値 = flag Cx Cy Cz = 画像の中心点  
flag = "s" は静的、"d" は動的  
Cx,Cy,Cz = 画像の中心点（ボックスの寸法の割合として指定）（0.5 = ボックスの中心）  
Cx,Cy,Cz は変数で指定できます（下記参照）  
up 値 = Ux Uy Uz = 画像内での「上」の方向  
Ux,Uy,Uz = 上方向ベクトルの成分  
Ux,Uy,Uz は変数で指定できます（下記参照）  
zoom 値 = zfactor = シミュレーションボックスの画像内でのサイズ  
zfactor = 画像サイズをスケール因子 > 1 で拡大、因子 < 1 で縮小  
zfactor は変数で指定できます（下記参照）  
persp 値 = pfactor = 画像の「遠近感」  
pfactor = 遠近感の強さ（0 = なし、< 1 = あり、> 1 = 強い歪み）  
pfactor は変数で指定できます（下記参照）  
box 値 = yes/no diam = シミュレーションボックスの外枠を描画するか  
yes/no = シミュレーションボックスの線を描画するかしないか  
diam = ボックス線の太さ（ボックスの最短辺の割合）  
axes 値 = yes/no length diam = xyz軸を描画するか  
yes/no = シミュレーションボックスの横にxyz軸線を描画するか  
length = 各軸線の長さ（それぞれのボックスの辺の割合）  
diam = 各軸線の太さ（ボックスの最短辺の割合）  
shiny 値 = sfactor = 球体と円柱の光沢  
sfactor = 球体と円柱の光沢の強さ（0.0 から 1.0）  
ssao 値 = yes/no seed dfactor = SSAO（スクリーン空間の奥行きシェーディング）  
yes/no = 奥行きシェーディングをオン/オフ  
seed = ランダム番号のシード（10000より大きい素数）  
dfactor = シェーディングの強さ（0.0 から 1.0）  

# 例
```
dump d0 all image 100 dump.*.jpg type type
dump d1 mobile image 500 snap.*.png element element ssao yes 123457 0.6
dump d2 all image 200 img-*.ppm type type zoom 2.5 adiam 1.5 size 1280 720
dump m0 all movie 1000 movie.mpg type type size 640 480
dump m1 all movie 1000 movie.avi type type size 640 480
dump m2 all movie 100 movie.m4v type type zoom 1.8 adiam v_value size 1280 720
```

# 説明
毎Nタイムステップで原子配置の高品質レンダリング画像をダンプし、画像をJPG、PNG、またはPPM形式のシーケンスとして、または1つのムービーファイルとして保存します。このコマンドのオプションや[dump_modify]()コマンドにより、画像やムービーに含まれる内容や表示方法が制御されます。このような画像の一連のものを手動で変換してシミュレーションのアニメーションムービーを作成することが簡単にできます。また、dump movieスタイルを使用することで、途中のファイルを保存せずに自動的にプロセスを実行することもできます。詳細については以下を参照してください。他のdumpスタイルは、原子に関連する数値データのスナップショットをさまざまな形式で保存します。このことについてはdumpのドキュメントページで説明されています。

なお、画像のセットやムービーは、シミュレーションが実行された後に、rerunコマンドを使用して既存のダンプファイルからスナップショットを読み込み、rerunスクリプトでこれらのダンプコマンドを使用して画像やムービーを生成することでも作成できます。

こちらは、1024x1024のJPGファイルとしてレンダリングされた2つのサンプル画像です。クリックすると、フルサイズの画像が表示されます：

指定されたグループの原子のみが画像にレンダリングされます。[dump_modify region と thresh]() コマンドを使用することで、画像に含まれる原子を変更することもできます。ファイル名の接尾辞によって、画像ダンプスタイルで作成されるファイルがJPEG、PNG、またはPPM形式かが決まります。接尾辞が ".jpg" または ".jpeg" の場合、JPEG形式のファイルが作成され、接尾辞が ".png" の場合、PNG形式のファイルが作成され、それ以外の場合はPPM（別名NETPBM）形式のファイルが作成されます。JPGおよびPNGファイルはバイナリ形式で、PPMはテキストモードのヘッダーとその後のバイナリデータから成ります。JPG画像はロスのある圧縮を使用しており、PNGはロスレス圧縮を使用しています。PPMファイルは圧縮されていませんが、LIGGGHTS(R)-PUBLICが -DLAMMPS_GZIP オプションでコンパイルされ、".gz" の接尾辞を使用するとgzipで圧縮できます。

同様に、結果として得られるムービーの形式は、ムービーダンプスタイルで選択されます。これは、基盤となるFFmpegコンバータによって処理されるため、詳細はFFmpegのドキュメントで確認する必要があります。典型的な例としては、.avi、.mpg、.m4v、.mp4、.mkv、.flv、.mov、.gifなどがあります。ムービーの圧縮設定（ビットレートやフレームレートなど）は、[dump_modify]() コマンドを使用して設定できます。

JPEGおよびPNG形式のファイルを出力するには、対応するJPEGまたはPNGライブラリのサポートでLIGGGHTS(R)-PUBLICをビルドする必要があります。画像をムービーに変換するには、LIGGGHTS(R)-PUBLICを -DLAMMPS_FFMPEG フラグ付きでコンパイルする必要があります。この方法については、マニュアルの該当セクションを参照してください。

[!WARNING]周期境界条件は隣接リストが再構築されるタイムステップでのみ適用されるため、画像における原子の座標はシミュレーションボックスの外にわずかに出ることがあります。

ダンプは、Nの倍数のタイムステップ（タイムステップ0を含む）および最小化が収束した場合の最終タイムステップで実行されます。これにより、ダンプコマンドが呼び出された直後の最初のタイムステップでは、現在のタイムステップがNの倍数でない場合、ダンプが実行されないことになります。この動作は、[dump_modify first]() コマンドを使用して変更でき、最小化が任意のタイムステップで終了した後にダンプコマンドが呼び出された場合に便利です。Nは、[dump_modify every]() コマンドを使用して、実行間で変更できます。

ダンプ画像のファイル名にはワイルドカード文字「\*」を含める必要があります。これにより、各スナップショットに対して1つの画像ファイルが書き込まれます。「\*」文字はタイムステップの値に置き換えられます。例えば、tmp.dump.*.jpg は tmp.dump.0.jpg, tmp.dump.10000.jpg, tmp.dump.20000.jpg などに変わります。[dump_modify pad]() コマンドを使用すると、すべてのタイムステップ番号を同じ長さに保つことができ（例：00010）、これにより、画像のシリーズを正しい順序でムービーに変換しやすくなります。

一方、ダンプムービーのファイル名にはワイルドカード文字を含めてはいけません。ムービーエンコーダーは、すべての画像を1つのムービーファイルに結合して書き込むため、1つのファイルしか作成されません。

カラーおよび直径の設定は、画像に描画される原子の色とサイズを決定します。これらは、[dump custom]()コマンドで定義された任意の原子属性（タイプや元素を含む）にすることができます。これには、[compute]()、[fix]()、または[variable]()によって計算された原子ごとの量も含まれ、これらはそれぞれ「c_」、「f_」、「v_」でプレフィックスが付けられます。なお、直径設定はオプションの「adiam」キーワードで数値値によって上書きできるため、その場合、任意の有効な原子属性で直径設定を指定できます。

カラー設定に「type」が指定された場合、各原子の色はその原子タイプによって決まります。デフォルトでは、タイプと色のマッピングは以下の通りです：

- type 1 = red
- type 2 = green
- type 3 = blue
- type 4 = yellow
- type 5 = aqua
- type 6 = cyan


タイプが6を超える場合、マッピングは繰り返されます。このマッピングは[dump_modify acolor]()コマンドによって変更できます。

直径設定に「type」が指定された場合、各原子の直径はその原子タイプによって決まります。デフォルトでは、すべてのタイプの直径は1.0です。このマッピングは[dump_modify adiam]()コマンドによって変更できます。

カラーおよび/または直径設定に「element」が指定された場合、各原子の色および/または直径は、その元素によって決まります。元素は「dump_modify element」コマンドで指定された元素とタイプのマッピングに基づいて決まります。デフォルトでは、すべての原子タイプはC（炭素）です。すべての元素には色と直径が関連付けられており、これは[AtomEye]()ビジュアライゼーションパッケージで使用される色とサイズと同じです。

他の原子属性が色または直径設定に使用される場合、それらは次のように解釈されます。

例えば、「vx」が色設定として使用される場合、原子の色はその速度のx成分に依存します。原子ごとの値と特定の色を関連付ける方法は「カラーマップ」によって決まります。このカラーマップは[dump_modify]()コマンドを使って指定できます。基本的な考え方は、原子属性が特定の範囲の値内にあり、その範囲内の各値が特定の色にマッピングされるというものです。カラーマップの定義によっては、このマッピングは補間を通じて行われ、例えば-3.2の値が「赤」と「青」の中間であるように、または離散的に行われ、-3.2の値が「オレンジ」になることもあります。

例えば、「vx」が直径設定として使用される場合、原子はその速度のx成分を直径としてレンダリングされます。もし原子ごとの値が<= 0.0の場合、その原子は描画されません。有限サイズの球形粒子は、[atom_style sphere]()で定義される半径または直径を持ち、それが直径設定として使用されることがあります。

上記にリストされたさまざまなキーワードは、画像のレンダリング方法を制御します。下記に示すように、すべてのキーワードにはデフォルト値があり、ほとんどの場合、変更する必要はありません。また、[dump modify]()には特にdump imageスタイルに関連したオプションがあり、原子、結合、その他の画像特徴に色を割り当てるために使用されます。

adiamキーワードは、指定された数値値を持つ原子属性に直径設定を上書きすることができます。すべての原子はその直径（例えば1.5）で描画されます。この直径は、入力スクリプトで定義された距離[units]()（例えばアンストローム）で指定されます。

atomキーワードは、指定された値が「no」の場合、すべての原子の描画をオフにすることができます。

bondキーワードは、結合の描画方法を変更できます。結合は、結合の両方の原子が指定されたグループに属し、他の選択基準（例えば、[dump_modify]()コマンドの領域や閾値設定）に基づいて描画される場合にのみ描画されます。デフォルトでは、結合は[read_data]()コマンドで読み込まれた入力データファイルで定義されている場合に描画されます。結合の色と幅の両方にnoneを指定すると、すべての結合の描画をオフにすることができます。

結合の色値にatomが指定されると、各結合は2つの半分で描画され、各半分の色はその結合の端にある原子の色になります。

結合の色値にtypeが指定されると、各結合の色はその結合タイプによって決まります。デフォルトでは、結合タイプと色のマッピングは以下のようになります。

- type 1 = red
- type 2 = green
- type 3 = blue
- type 4 = yellow
- type 5 = aqua
- type 6 = cyan


結合タイプが6を超えると、上記のマッピングが繰り返されます。このマッピングは、[dump_modify bcolor]()コマンドによって変更できます。

結合幅の値は数値、atom、type（または上記のようにnone）のいずれかで指定できます。

数値が指定された場合、すべての結合はその直径（例えば1.0）を持つ円柱として描画されます。この直径は、入力スクリプトで定義された距離[units]()（例えばアンストローム）で指定されます。

atomが幅の値として指定された場合、各結合はその結合に関与する2つの原子の最小直径に対応する幅で描画されます。

typeが幅の値として指定された場合、各結合の直径はその結合タイプによって決まります。デフォルトでは、すべての結合タイプは直径0.5です。このマッピングは、[dump_modify bdiam]()コマンドで変更できます。

sizeキーワードは、作成される画像の幅と高さを設定します。すなわち、各方向のピクセル数を指定します。

view、center、up、zoom、およびperspの値は、3Dシミュレーション空間が画像の2D平面にどのようにマッピングされるかを決定します。基本的に、これらの値はシミュレーションボックスが画像にどのように表示されるかを制御します。

view、center、up、zoom、およびperspのすべての値は、数値として指定できます。これらの意味については下記で説明します。また、いずれもv_nameという形式で等式スタイルの変数として指定することもできます。この場合、「name」は変数名であり、変数は画像が作成される各タイムステップで評価され、新しい値が作成されます。[equal-style variable]()が時間依存である場合、これはシミュレーションボックスの見え方を画像ごとに変更する手段となり、効果的にシミュレーションのパンやフライバイビューを実現します。

viewキーワードは、シミュレーションボックスがどの視点から見られるか、すなわち中心点を向いているかを決定します。theta値は+z軸からの垂直角度で、0度から180度の範囲で指定しなければなりません。phi値はz軸回りの方位角で、正の値または負の値が指定できます。0.0の値は、+x軸に沿った中心点への視点を意味します。thetaやphiが変数を通じて指定される場合、変数の値は度単位で指定する必要があります。

centerキーワードは、シミュレーション空間内で画像の中心に配置されるポイントを決定します。Cx、Cy、およびCzはボックスの次元の割合として指定され、(0.5, 0.5, 0.5)がシミュレーションボックスの中心を意味します。これらの値は0.0から1.0の範囲である必要はなく、シミュレーションボックスを画像の中心からオフセットさせることも可能です。ただし、Cx、Cy、Czに奇妙な値を選択すると、空白の画像が生成される可能性があることに注意してください。内部的には、Cx、Cy、Czはシミュレーション空間内のポイントに変換されます。flagが「s」に設定されている場合（静的の場合）、この変換はダンプコマンドが発行されたときに一度だけ行われます。flagが「d」に設定されている場合（動的の場合）、新しい画像が作成されるたびに変換が行われます。ボックスのサイズや形状が変化する場合、シミュレーション空間内での中心点が調整されます。

upキーワードは、シミュレーション空間内で画像における「上」の方向を決定します。内部的には、これはthetaとphi値によって示されるビュー・ベクトルに垂直な平面内にあり、かつビュー・ベクトルとユーザー指定のupベクトルによって定義される平面内にもあるベクトルとして保存されます。したがって、この内部ベクトルはユーザー指定のupベクトルから次のように計算されます。

```
up_internal = view cross (up cross view)
```

これは、指定されたupベクトルの制限は、ビュー・ベクトル（thetaとphi値によって示される）と平行でないことだけであることを意味します。

zoomキーワードは、画像に表示されるシミュレーションボックスのサイズをスケールします。デフォルトのzfactor値1は、シミュレーションボックス内の原子でほぼ埋め尽くされた画像を表示するはずです。zfactorが1より大きいとシミュレーションボックスが大きくなり、zfactorが1より小さいとシミュレーションボックスが小さくなります。zfactorは0.0より大きい値でなければなりません。

perspキーワードは、画像内での奥行きのパースペクティブの強さを決定します。奥行きのパースペクティブは、シミュレーション空間で平行な線が画像内で非平行に見えるようにします。pfactorの値が0.0の場合、平行な線は無限遠で交わることになり（1.0/pfactor）、これはパースペクティブのない直交投影です。pfactorが0.0と1.0の間の値では、より多くのパースペクティブが導入されます。pfactorが1より大きいと、非常に歪んだ画像が作成され、大きなパースペクティブが得られます。

[!WARNING]perspキーワードは、まだオプションとしてサポートされていません。

boxキーワードは、シミュレーションボックスの境界が画像内で細い円筒としてどのように描画されるかを決定します。noが設定されている場合、ボックスの境界線は描画されず、diam設定は無視されます。yesが設定されている場合、ボックスの12本の辺が描画され、その直径はx、y、zの最短ボックス長さの割合になります（3Dの場合）、またはx、y（2Dの場合）。ボックス境界の色は、[dump_modify boxcolor]()コマンドで設定できます。

axesキーワードは、座標軸が画像内で細い円筒としてどのように描画されるかを決定します。noが設定されている場合、座標軸は描画されず、lengthおよびdiam設定は無視されます。yesが設定されている場合、3本の細い円筒が描画され、それぞれx、y、z軸を表し、色は赤、緑、青です。これらの円筒の原点は、ボックスの左下隅から10％オフセットされます。length設定は、円筒の長さをそれぞれのボックス長さの割合で決定します。diam設定は、それらの厚さをx、y、zの最短ボックス長さの割合で決定します（3Dの場合）またはx、y（2Dの場合）。

shinyキーワードは、画像内で描画されるオブジェクトがどれくらい光沢があるように見えるかを決定します。sfactor値は、0.0 <= sfactor <= 1.0の範囲で、sfactor = 1は非常に反射的な表面を、sfactor = 0は粗い光沢のない表面を意味します。

ssaoキーワードは、深度シェーディングのためのスクリーンスペース・アンビエント・オクルージョン（SSAO）モデルをオン/オフします。yesが設定されている場合、視点から遠くにある原子がランダム化されたプロセスによって暗くなり、これが深度として認識されます。この効果の計算は、画像の計算コストを約2倍増加させる可能性があります。効果の強さは、dfactorパラメータでスケーリングできます。noが設定されている場合、深度シェーディングは行われません。

JPG、PNG、またはPPMの画像のシリーズは、ムービーファイルに変換して、一般的に利用可能なツールを使用してムービーとして再生できます。dump style movieを使用することで、この手順が自動化され、（多くの）画像スナップショットファイルを作成する中間ステップを避けることができます。ただし、LIGGGHTS(R)-PUBLICは-DLAMMPS_FFMPEGでコンパイルされ、FFmpegの実行可能ファイルがインストールされている必要があります。

JPG、PNG、またはPPMファイルを手動でアニメーションGIFやMPEG、その他のムービーファイルに変換するには、次の方法を使用できます：

a.ImageMagickのconvertプログラムを使用する方法：  
```
% convert *.jpg foo.gif
% convert -loop 1 *.ppm foo.mpg
```
ImageMagickで作成されたアニメーションGIFファイルは最適化されていません。gifsicleなどのプログラムを使用して最適化し、大幅にサイズを縮小できます。ImageMagickで作成されたMPEGファイルはMPEG-1形式で、圧縮効率が悪く、品質が低いです。

b.QuickTimeを使用する方法：  
ファイルメニューから「Open Image Sequence」を選択
QuickTimeに画像をロードしてアニメーションを作成
ファイルメニューから「Export」を選択
ムービーをQuickTimeムービー（*.mov）または他の形式で保存
QuickTimeは非常に高品質で効率的に圧縮されたムービーファイルを生成できます。いくつかのサポートされているフォーマットにはライセンスを購入する必要があり、特定のランタイムライブラリがインストールされていないプラットフォームでは読み取れないことがあります。

c.FFmpegを使用する方法：  
FFmpegは多くのプラットフォームで利用可能なコマンドラインツールで、非常に柔軟な映画のエンコードとデコードが可能です。
```
cat snap.*.jpg | ffmpeg -y -f image2pipe -c:v mjpeg -i - -b:v 2000k movie.m4v
cat snap.*.ppm | ffmpeg -y -f image2pipe -c:v ppm -i - -b:v 2400k movie.avi
```
FFmpegには複数のプラットフォーム用のフロントエンドがあります。詳細については、FFmpegのホームページを参照してください。

動画を再生する方法：

a. ブラウザを使ってアニメーションGIFムービーを表示する方法： ファイルメニューから「Open File」を選択して、アニメーションGIFファイルを読み込みます。

b. 無料で利用できるmplayerまたはffplayツールを使用してムービーを表示する方法： どちらも複数のOSで利用でき、さまざまなファイル形式やデコーダーをサポートしています。

```
% mplayer foo.mpg
% ffplay bar.avi
```

c. Pizza.py animateツールを使用する方法：このツールは画像ファイルのシリーズに直接作用します。
```
a = animate("foo*.jpg")
```

d. QuickTimeや他のWindowsまたはMacOSベースのメディアプレイヤーは、ムービーファイルを直接再生できます。同様に、Linuxデスクトップ環境に付属のツールでも再生できますが、一部のファイル形式にはライセンスの問題があるため、追加のライブラリをインストールする、ライセンスを購入する、またはサポートされていない場合があります。

新しい計算や修正スタイルをLIGGGHTS(R)-PUBLICに追加して、原子ごとのデータを計算し、それをダンプファイルに出力する方法については、マニュアルの「Section_modify」を参照してください。

# 制限事項
JPG画像を出力するには、LIGGGHTS(R)-PUBLICをビルドする際に「-DLAMMPS_JPEG」スイッチを使用し、JPEGライブラリとリンクする必要があります。PNG画像を出力するには、LIGGGHTS(R)-PUBLICをビルドする際に「-DLAMMPS_PNG」スイッチを使用し、PNGライブラリとリンクする必要があります。

ムービーダンプを出力するには、LIGGGHTS(R)-PUBLICをビルドする際に「-DLAMMPS_FFMPEG」スイッチを使用し、FFmpegの実行可能ファイルがLIGGGHTS(R)-PUBLICが実行されているマシンにインストールされている必要があります。

LIGGGHTS(R)-PUBLICのオプションの設定とコンパイル方法については、ドキュメントの「Making LIGGGHTS(R)-PUBLIC」セクションを参照してください。

# 関連コマンド
[dump](), [dump_modify](), [undump]()

# デフォルト

キーワードのデフォルト設定は次の通りです：

- adiam = 指定なし（直径設定を使用）
- atom = yes
- bond = none none（システムに結合がない場合）
- bond = atom 0.5（システムに結合がある場合）
- size = 512 512
- view = 60 30（3Dの場合）
- view = 0 0（2Dの場合）
- center = s 0.5 0.5 0.5
- up = 0 0 1（3Dの場合）
- up = 0 1 0（2Dの場合）
- zoom = 1.0
- persp = 0.0
- box = yes 0.02
- axes = no 0.0 0.0
- shiny = 1.0
- ssao = no