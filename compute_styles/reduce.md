# compute reduce command
# compute reduce/region command

## 構文
```
compute ID group-ID style general_keyword general_values arg mode input1 input2 ... keyword args ...
```

- ID、group-IDはcomputeコマンドで文書化されています。
- style = reduce または reduce/region
- general_keywords general_valuesはcomputeで文書化されています。
- 
reduce arg = none  
reduce/region arg = region-ID  
region-ID = 使用する原子を選択するための領域ID

- mode = sum、min、max、ave
- 1つ以上の入力をリストすることができます。
- input = x, y, z, vx, vy, vz, fx, fy, fz, c_ID, c_ID[N], f_ID, f_ID[N], v_name

x, y, z, vx, vy, vz, fx, fy, fz = 原子の属性（位置、速度、力の成分）  
c_ID = computeによって計算された原子またはローカルベクトル  
c_ID[I] = computeによって計算された原子またはローカル配列のI列目  
f_ID = fixによって計算された原子またはローカルベクトル  
f_ID[I] = fixによって計算された原子またはローカル配列のI列目  
v_name = atom-style変数によって計算された原子ベクトルの名前

- ゼロまたはそれ以上のkeyword/argsペアを追加することができます。
- keyword = replace

replace args = vec1 vec2  
vec1 = この入力ベクトルからの縮小された値が置き換えられます  
vec2 = vec1[N]に置き換えられるNは、vec2の最大値または最小値のインデックスです

## 例
```
compute 1 all reduce sum c_force
compute 1 all reduce/region subbox sum c_force
compute 2 all reduce min c_press**2** f_ave v_myKE
compute 3 fluid reduce max c_index**1** c_index**2** c_dist replace 1 3 replace 2 3
```

## 説明
1つ以上のベクトル入力をスカラー値に「縮小」する計算を定義します。各入力ごとに1つのスカラー値が計算されます。入力は、アトム単位またはローカルの量であり、グローバルな量は使用できません。アトムの属性はアトム単位の量であり、[computes]()や[fix]()は3種類の量のいずれかを生成でき、[atom-style variables]()はアトム単位の量を生成します。グローバルベクトルに対して同様の操作を実行できる変数コマンドやその特殊な関数については、[variable]()コマンドを参照してください。

縮小操作は、モード設定によって指定されます。sumオプションは、ベクトル内の値を加算してグローバルな合計を求めます。minまたはmaxオプションは、すべてのベクトル値の最小値または最大値を見つけます。ave設定は、ベクトルの値をグローバルな合計に加算し、その後、ベクトルの値の数で割ります。

リストに挙げた各入力は独立して処理されます。アトム単位の入力の場合、このコマンドで指定されたグループは、そのグループ内のアトムのみが結果に寄与することを意味します。アトム単位の入力の場合、compute reduce/region コマンドが使用されると、アトムは現在その領域内に存在している必要があります。アトム単位の量を生成する入力は、戻り値に影響を与える独自のグループを定義する場合があることに注意してください。たとえば、アトム単位のベクトルを生成する compute が入力として使用される場合、その compute に指定されたグループにいないアトムには0.0の値が生成されます。

リストに挙げた各入力は、アトムの属性（位置、速度、力の成分）であるか、[compute]() や [fix]() の結果、またはアトムスタイルの[variable]()の評価結果である場合があります。

アトム属性の値（x, y, z, vx, vy, vz, fx, fy, fz）は、直感的に理解できるものです。なお、[compute property/atom]() コマンドを使用し、その compute からの入力値を指定することで、他のアトム属性もこのフィックスの入力として使用できます。

値が「c_」で始まる場合、その後に入力スクリプトで以前に定義された compute のIDが続く必要があります。compute はアトム単位またはローカルな量を生成できます。詳細については、個別の [compute]() のドキュメントページを参照してください。ブラケット付きの整数が付けられていない場合は、compute によって計算されたベクトルが使用されます。ブラケット付きの整数が付けられている場合は、compute によって計算された配列のI番目の列が使用されます。ユーザーは、自分自身の compute スタイルのコードを作成して、LIGGGHTS(R)-PUBLICに追加することもできます。

値が「f_」で始まる場合、その後に入力スクリプトで以前に定義された fix のIDが続く必要があります。fix はアトム単位またはローカルな量を生成できます。詳細については、個別の fix のドキュメントページを参照してください。注意すべき点として、いくつかの fix は特定のタイムステップでのみ値を生成するため、compute reduce がその値を参照するタイミングと互換性がある必要があります。互換性がない場合、エラーが発生します。ブラケット付きの整数が付けられていない場合は、fix によって計算されたベクトルが使用されます。ブラケット付きの整数が付けられている場合は、fix によって計算された配列のI番目の列が使用されます。ユーザーは、自分自身の fix スタイルのコードを作成して、LIGGGHTS(R)-PUBLICに追加することもできます。

値が「v_」で始まる場合、その後に入力スクリプトで以前に定義された変数名が続く必要があります。それはアトムスタイルの変数でなければなりません。[atom-style variable]()は、熱力学的キーワードやさまざまなアトム単位の属性を参照したり、他の compute、fix、または変数を評価時に呼び出したりすることができるため、アトム単位の量を生成して削減するための非常に一般的な手段です。

replace キーワードが使用される場合、vec1 と vec2 の2つのインデックスが指定されます。各インデックスは1から入力値の数までの範囲です。replace キーワードは、mode が min または max の場合にのみ使用できます。動作は次のようになります。vec2 入力ベクトルに対して通常通り min / max が計算され、その値が vec2 内でどの位置にあるかのインデックスNも保存されます。次に、vec1 入力ベクトルでの min / max 計算を行う代わりに、保存されたインデックスを使って vec1 ベクトルのN番目の要素を選択します。

例えば、この計算を使用して最大伸びを持つ結合を見つけたい場合は、次のように行うことができます：

```
compute 1 all property/local batom1 batom2
compute      2 all bond/local dist
compute      3 all reduce max c_1[1] c_1[2] c_2 replace 1 3 replace 2 3
thermo_style custom step temp c_3[1] c_3[2] c_3[3]
```

compute reduce コマンドの最初の2つの入力値は、[compute property/local]() コマンドを使用して各結合の2つの原子のIDを示すベクトルです。最後の入力値は、[compute bond/local]() コマンドを使用した結合距離です。2つの原子IDベクトルの最大値を取る代わりに（この文脈では有用な情報を得られないため）、replace キーワードは最大伸びを持つ結合の2つの原子IDを抽出します。これらの原子IDと結合の伸びは、熱力学的な出力とともに出力されます。

入力が1つだけ指定された場合、この計算はグローバルなスカラー値を生成します。複数の入力が指定された場合、この計算は指定された入力の数と同じ長さのグローバルベクトルを生成します。

以下で説明するように、sum モードの場合、この計算で生成される値はすべて「拡張的」であり、これは関与する原子の数に対して線形にスケールすることを意味します。正規化された値が必要な場合、この計算は [thermo_style custom]() コマンドで [thermo_modify norm yes]() をオプションとして設定してアクセスすることができます。または、適切な原子数で割る[variable]()を使用してアクセスすることも可能です。

## 出力情報
この計算は、入力値が1つだけ指定された場合にはグローバルスカラーを計算し、複数の入力が指定された場合には長さNのグローバルベクトルを計算します。ここでNは入力の数であり、インデックス1からNでアクセスできます。これらの値は、グローバルスカラーまたはベクトル値を入力として使用する任意のコマンドで使用できます。LIGGGHTS(R)-PUBLICの出力オプションの概要については、セクション15を参照してください。

この計算で計算されるすべてのスカラーまたはベクトル値は「集約的」であり、sum モードが使用される場合、入力が原子ごとのベクトルまたはローカルベクトルである場合には、計算された値は「拡張的」となります。

スカラーまたはベクトルの値は、減算される量が持つ単位に対応します。

## 制限事項
none

## 関連コマンド
[compute](), [fix](), [variable]()

## デフォルト
none