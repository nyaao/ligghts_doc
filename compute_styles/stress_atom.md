# compute stress/atom command

## 構文
```
compute ID group-ID stress/atom general_keyword general_values keyword ...
```
- IDおよびgroup-IDは、computeコマンドで説明されています。
- stress/atomは、このcomputeコマンドのスタイル名です。
- general_keywordsおよびgeneral_valuesは、computeコマンドで説明されています。
- 0個以上のキーワードを追加することができます。
- キーワードの種類: ke（運動エネルギー）、pair（ペア相互作用）、bond（結合相互作用）、angle（角度相互作用）、dihedral（二面角相互作用）、improper（不適切相互作用）、kspace（k空間相互作用）、fix（固定相互作用）、virial（ビリアル）。

## 例
```
compute 1 mobile stress/atom
compute 1 all stress/atom pair bond
```

## 説明
グループ内の各原子に対して、対称な1原子ごとの応力テンソルを計算する計算を定義します。各原子のテンソルは6つの成分を持ち、以下の順序で6要素のベクトルとして格納されます：xx, yy, zz, xy, xz, yz。システム全体の応力テンソル（圧力）を求めたい場合は、[compute pressure]()コマンドを参照してください。
原子Iの応力テンソルは次の式で与えられます。このとき、aおよびbはx, y, zの値を取り、対称テンソルの6つの成分を生成します：

$$
S_{ab}=-\left[ mv_av_b+
    \frac{1}{2}\sum_{n=1}^{N_p}\left(r_{1_a}F_{1_b}+r_{2_a}F_{2_b}\right)+
    \frac{1}{2}\sum_{n=1}^{N_b}\left(r_{1_a}F_{1_b}+r_{2_a}F_{2_b}\right)+
    \frac{1}{3}\sum_{n=1}^{N_a}\left(r_{1_a}F_{1_b}+r_{2_a}F_{2_b}+r_{3_a}F_{3_b}\right)+
    \frac{1}{4}\sum_{n=1}^{N_d}\left(r_{1_a}F_{1_b}+r_{2_a}F_{2_b}+r_{3_a}F_{3_b}+r_{4_a}F_{4_b}\right)+
    \frac{1}{4}\sum_{n=1}^{N_i}\left(r_{1_a}F_{1_b}+r_{2_a}F_{2_b}+r_{3_a}F_{3_b}+r_{4_a}F_{4_b}\right)+
    Kspace(r_{i_a}, F_{i_b})+
    \sum_{n=1}^{N_f}r_{i_a}F_{i_b}
    \right]
$$
最初の項は、原子Iに対する運動エネルギーの寄与を表します。
2番目の項は、ペアワイズエネルギーの寄与であり、nは原子Iの近接する隣接原子数（Np）のループを示します。r1およびr2はペアワイズ相互作用に関与する2つの原子の位置を表し、F1およびF2はその相互作用によって発生する2つの原子への力を表します。
3番目の項は、原子Iが関与する結合（Nb個）に対応した類似の形式の結合寄与です。

また、原子Iが関与するNa個の角度相互作用、Nd個の二面角相互作用、Ni個の不適切相互作用に対応する同様の項があります。さらに、定義されていれば、長距離クーロン相互作用によるKSpace寄与に対応する項も含まれます。最後に、原子Iに内部拘束力を適用するNf個の固定（[fix]()）に対応する項があります。現在、この項に寄与するのはfix shakeおよび[fix rigid]()コマンドのみです。

[!WARNING]粒状システムの場合、この式は運動エネルギー寄与における平均速度の寄与を無視しています。この修正はcompute ave/eulerコマンドで行われますが、現時点ではドキュメントが存在しません。


この式の係数が示すように、少数の原子セット（例: 二面角に関与する4つの原子やTersoff 3体相互作用に関与する3つの原子）によって生成されるビリアル寄与は、そのセット内の各原子に均等に分配されます。例えば、二面角のビリアルは4つの原子それぞれに1/4ずつ割り当てられ、水分子の原子にfix shakeコマンドを通じて適用されるSHAKE拘束によるfixビリアルは、それぞれの原子に1/3ずつ割り当てられます。

追加のキーワードが指定されていない場合、この式のすべての項が1原子ごとの応力テンソルに含まれます。追加のキーワードが指定された場合、それらの項のみを合計してテンソルを計算します。virialキーワードは、運動エネルギーkeを除くすべての項を含むことを意味します。

各原子の応力は、シミュレーション内の他のすべての原子との相互作用に起因するものであり、同じグループ内の他の原子とのみの相互作用ではありません。

dihedral_style charmmスタイルは、1対4の原子間のペアワイズ相互作用を計算します。これらの相互作用によるビリアル寄与は、二面角ビリアルではなくペアビリアルに含まれます。

KSpaceの寄与は、Ewald法の場合は(Heyes, Phys Rev B 49, 755 (1994),)の方法を使用して計算され、PPPMの場合は(Sirk, Moore, Brown, J Chem Phys, 138, 064505 (2013).)で説明されている方法論に基づいて計算されます。KSpaceソルバーの選択は、kspace_style pppmコマンドで指定されます。なお、PPPMの場合、1原子ごとの応力が計算されるタイムステップごとに6つの追加FFT計算が必要になります。そのため、シミュレーションのタイムステップの大部分でこの計算が必要な場合、PPPM計算のコストが大幅に増加する可能性があります。

式で定義されているように、1原子ごとの応力は、1原子ごとの圧力テンソルの負の値です。また、これは実際には「応力×体積」の形式であり、計算された量の単位は「圧力×体積」となります。この値を応力（圧力）の単位に変換するには、1原子ごとの体積で割る必要がありますが、変形した固体や液体では、個々の原子の体積は明確に定義されておらず、計算も容易ではありません。そのため、システム内のすべての原子の1原子ごとの応力テンソルの対角成分を合計し、その合計をdVで割ると、結果は-P（Pはシステム全体の圧力）になるはずです。ここで、dは次元数、Vはシステムの体積を表します。

以下のような3次元システム用の入力スクリプトの記述は、その結果を得るはずです。つまり、thermo出力の最後の2列が同じになるはずです。

```
compute              peratom all stress/atom
compute              p all reduce sum c_peratom[1] c_peratom[2] c_peratom[3]
variable     press equal -(c_p[1]+c_p[2]+c_p[3])/(3*vol)
thermo_style custom step temp etotal press v_press
```

## 出力情報
このcomputeは、6列の1原子ごとの配列を計算します。この配列は、1-6のインデックスでアクセス可能であり、計算結果を入力として使用する任意のコマンドから利用できます。Section_howto 15を参照すると、LIGGGHTS(R)-PUBLICの出力オプションに関する概要が確認できます。

1原子ごとの配列の値は、前述のように「圧力×体積」の[units]()になります。

## 制限事項
none

## 関連コマンド
[compute pe](), [compute pressure]()

## デフォルト
none