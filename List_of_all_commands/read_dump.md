# read_dump command

## 構文
```
read_dump file Nstep field1 field2 ... keyword values ...
```

以下は、ダンプファイルを読み込むための設定です：

- file = 読み込むダンプファイルの名前
- Nstep = ファイルから読み取るスナップショットのタイムステップ
- 1つ以上のフィールドを追加することができます：

field = x, y, z, vx, vy, vz, q, ix, iy, iz など  
x, y, z = 原子の座標  
radius = 原子の半径  
vx, vy, vz = 速度成分  
q = 電荷  
ix, iy, iz = 各軸のイメージフラグ  
この設定により、ダンプファイルから特定のデータを選択して読み取ることができます。

- zero or more keyword/value pairs は追加できます。
- keyword = box, replace, purge, trim, add, label, scaled, wrapped, format など。

box value = yes or no  
ダンプボックスでシミュレーションボックスを置き換えるかどうかを指定します。  
replace value = yes or no  
ダンプ内の原子で既存の原子を上書きするかどうかを指定します。  
purge value = yes or no  
ダンプの原子を追加する前に、すべての原子を削除するかどうかを指定します。  
trim value = yes or no  
ダンプスナップショットに含まれない原子を削除するかどうかを指定します。  
add value = yes or no  
新しいダンプ原子をシステムに追加するかどうかを指定します。  
label value = field column  
フィールド列のラベルを設定します。  
field = リストされているフィールドのいずれか、または id, type など。  
column = ダンプファイル内の対応する列のラベル。  
scaled value = yes or no  
ダンプファイル内の座標がスケールされているかどうかを指定します。  
wrapped value = yes or no  
ダンプファイル内の座標がラップされているかどうかを指定します。  
format values = ダンプファイルの形式（最後のキーワードとして使用する必要があります）  
native = LIGGGHTS(R)-PUBLICのネイティブダンプファイル形式。  
xyz = XYZファイル形式。  

## 例
```
read_dump dump.file 5000 x y z radius
read_dump dump.xyz 5 x y z radius format xyz box no
read_dump dump.file 5000 x y vx vy radius trim yes
read_dump ../run7/dump.file.gz 10000 x y z radius box yes
read_dump dump.xyz 5 x y z radius box no format xyz
```

## 説明
ダンプファイルから原子情報を読み込んで、現在の原子座標を上書きし、オプションで原子速度やイメージフラグ、シミュレーションボックスの寸法を更新することができます。これは、ダンプファイル内の特定のスナップショットからシミュレーションを再開する際に有用です。この方法の代替として、[read_restart]()や[read_data]()コマンドを使用できます。また、rerunコマンドを使用することで、ダンプファイルから複数のスナップショットを読み込むことも可能です。

注意点として、read_dumpコマンドを使用する前にシミュレーションボックスが既に定義されている必要があります。これには、[create_box]()、[read_data]()、または[read_restart]()コマンドを使用できます。read_dumpコマンドは、以下のようにシミュレーションボックスの寸法をリセットすることができます。

LIGGGHTS(R)-PUBLICでは有効な半径が必要であるため、radiusフィールドは必須で読み込まれます。

また、ダンプスナップショットから読み取ることができる原子情報は、原子座標、半径、速度、イメージフラグに限定されている点に注意してください。原子の電荷や分子系の結合トポロジー情報など、シミュレーションを実行するために必要な他の原子プロパティはダンプファイルから読み取ることはできません（また、ダンプファイルには含まれていません）。したがって、このような補助的な情報は通常の方法で定義しておく必要があります。例えば、[read_data]()コマンドで読み込むデータファイルに記載するか、read_dumpコマンドでダンプスナップショットを読み込んだ後に[set]()コマンドを使用して設定します。

ファイル名が「.gz」で終わるダンプファイルが指定されている場合、そのダンプファイルはgzipped形式で読み込まれます。現在のところ、バイナリ形式で書き込まれた「.bin」サフィックスを持つダンプファイルや、「%」オプションで複数のファイルに書き込まれたダンプファイルを読み込むことはできません。詳細は[dump]()コマンドを参照してください。

ダンプファイルの形式は、formatキーワードで選択されます。指定する場合、それは最後のキーワードでなければならず、残りの引数はすべてダンプリーダーに渡されます。ネイティブ形式は、LIGGGHTS(R)-PUBLICのネイティブダンプファイル用で、「dump atom」や「[dump custom]()」コマンドで書き込まれたファイルに対応しています。xyz形式は、汎用のXYZ形式で書かれたダンプファイル用です。

将来的には、他のダンプ形式のリーダーのサポートが追加される可能性があります。

ダンプファイルから最初に読み込まれるのは、タイムステップとボックス情報です。

ダンプファイルは、指定されたNstepに一致するタイムスタンプを持つスナップショットを検索します。これは、ネイティブ形式の場合、ダンプファイルスナップショットが書き込まれたLIGGGHTS(R)-PUBLICのタイムステップを意味します。ただし、xyz形式はタイムステップを保存しないため、この形式ではタイムステップは論理的に連番で番号付けされ、0から始まります。したがって、xyzまたはmofile形式のダンプファイルで10番目のスナップショットにアクセスするには、Nstep = 9を使用します。

選択されたスナップショットのシミュレーションボックスの寸法も読み込まれます。ボックスに関する詳細は、以下のboxキーワードの説明を参照してください。ネイティブ形式の場合、スナップショットがトライクリニックボックス用で、現在のシミュレーションボックスが直交座標系の場合、またはその逆の場合、エラーが発生します。スナップショットのボックス境界条件（周期的、シュリンクラップなど）が現在のシミュレーション境界条件と一致しない場合、警告が生成されますが、スナップショット内の境界条件情報は無視されます。詳細については、「boundary」コマンドを参照してください。

xyz形式の場合、ボックスに関する情報は提供されないため、boxフラグを「no」に設定する必要があります。詳細は以下を参照してください。

ダンプファイルのスナップショットからの各原子に関する情報は、次にダンプファイルのスナップショットから読み取られます。これは、read_dumpコマンドで指定されたフィールドに対応します。2次元シミュレーションの場合、z、vz、またはizといったz次元のフィールドを指定することはエラーとなります。

ネイティブ形式のダンプファイルでは、各原子データの列にはファイルにテキストラベルが記載されています。各フィールドには一致するラベルが必要です。例えば、フィールド「vy」に対してラベル「vy」が必要です。x、y、zフィールドに関しては、次のいずれかのラベルが一致すると見なされます。

```
x, xs, xu, xsu for field x
y, ys, yu, ysu for field y
z, zs, zu, zsu for field z
```

xs（スケーリング済み）、xu（アンラップ済み）、およびxsu（スケーリング済みかつアンラップ済み）の意味は、dumpコマンドのドキュメントページで説明されています。これらのラベルは、ダンプファイルの列ラベルのリスト内で、順番に検索され、一致するものが見つかるまで探されます。

ダンプファイルには、原子IDも含まれている必要があり、その列ラベルは「id」である必要があります。

また、addキーワードが「yes」で指定された場合（以下で説明）、ダンプファイルには原子タイプが含まれている必要があり、その列ラベルは「type」である必要があります。

もしダンプファイルから読み取ろうとしている列ラベルが指定されたフィールドに一致しない場合、labelキーワードを使用して、そのフィールドに関連付けるための特定の列ラベルを指定することができます。例えば、fix ave/atomコマンドで時間平均された座標がダンプファイルに書き込まれた場合、その列は「x」や「xs」ではなく、fix-IDに対応するラベルを持つことになります。labelキーワードは、idおよびtypeフィールドのために新しい列ラベルを指定するためにも使用できます。

xyz形式のダンプファイルでは、x、y、zフィールドのみがサポートされています。ダンプファイルには原子IDが保存されていないため、これらはダンプファイルに現れる原子に対して、1から順番に割り当てられます。したがって、XYZダンプファイル内でスナップショットごとに原子の順序が一貫していることを確認する必要があります。もしXYZダンプファイルがLIGGGHTS(R)-PUBLICによって書き込まれた場合、[dump_modify sort]()コマンドを参照してください。

ダンプファイルスナップショットの情報は、現在のシステムのプロパティを上書きまたは置き換えるために使用されます。これがどのように行われるかは、指定されたフィールドとオプションのキーワードによって決まります。

スナップショットのタイムステップは、シミュレーションの現在のタイムステップとなります。もしダンプスナップショットが読み込まれた後にこれを変更したい場合は、[reset_timestep]()コマンドを参照してください。

boxキーワードが「yes」の値で指定された場合、現在のシミュレーションボックスの寸法はダンプスナップショットのボックス寸法に置き換えられます。boxキーワードが「no」の値で指定された場合、現在のシミュレーションボックスは変更されません。

purgeキーワードが「yes」の値で指定された場合、replace、trim、またはaddキーワードによって呼び出される操作が実行される前に、システム内の現在のすべての原子が削除されます。

replaceキーワードが「yes」の値で指定された場合、現在のシステムとダンプスナップショットの両方に存在するIDの原子は、そのフィールド値でプロパティが上書きされます。replaceキーワードが「no」の値で指定された場合、現在のシステムとダンプスナップショットの両方に存在するIDの原子は変更されません。

trimキーワードが「yes」の値で指定された場合、現在のシステムに存在するがダンプスナップショットに存在しないIDの原子は削除されます。trimキーワードが「no」の値で指定された場合、これらの原子は影響を受けません。

addキーワードが「yes」の値で指定された場合、ダンプスナップショットに存在するが現在のシステムには存在しないIDの原子がシステムに追加されます。addキーワードが「no」の値で指定された場合、これらのダンプ原子は無視されます。

addキーワードを使用して追加された原子には、フィールド引数から読み取られた属性のみが設定されることに注意してください。もしx、y、またはzがフィールドとして指定されていない場合、追加された原子には0.0の値が使用されます。追加された原子には原子タイプが必要なので、この値はダンプファイルに含まれていなければなりません。

他の属性（例えば、球形粒子の電荷や粒子径など）はデフォルト値に設定されます。これは、[create_atoms]()コマンドを使用した場合と同様です。

addキーワードを使用して追加された新しいダンプスナップショットの原子については、原子IDが保持されません。追加された原子に新しい原子IDを割り当てる手順は、[create_atoms]()コマンドで説明されているものと同様です。

ダンプファイルから読み取られた原子の座標は、最初にスケールされていない座標に変換され、スナップショットのボックス次元に対して相対的に処理されます。その後、これらの座標は現在のシミュレーション内の既存の原子または新しい原子に割り当てられます。座標は、その後、シミュレーションボックス（元のボックスまたはダンプスナップショットのボックス）に再マッピングされます。周期的境界条件が適用されている場合、原子は必要に応じてシミュレーションボックスに再マッピングされます。シュリンクラップ境界条件が適用される場合、新しい座標によってシミュレーションボックスの次元が変更されることがあります。固定境界条件が適用される場合、原子がシミュレーションボックスの外にあると、その原子は失われます。

ネイティブ形式のダンプファイルの場合、ダンプファイル内の原子に対する3つのxyz画像フラグは、ix、iy、izフィールドが指定されていれば、ダンプファイルに表示される対応する値に設定されます。指定されていない場合、置き換えられた原子の画像フラグは変更されず、新しい原子の画像フラグはデフォルト値に設定されます。ダンプファイルから読み取られた座標がアンラップ形式（例：xu）の場合、読み込まれた原子の画像フラグもデフォルト値に設定されます。その後、前述の再マッピング手順に従って、周期的境界条件が適用される場合、すべての原子（古いものと新しいもの）の画像フラグが再マッピングされてシミュレーションボックスに戻されます。

[!WARNING]ダンプスナップショットを読み込んだ後に画像フラグの不一致に関する警告が表示された場合、それは1つ以上の結合された原子ペアが現在不一致な画像フラグを持っていることを意味します。セクション「エラー」に記載されているように、これがその後のシミュレーションに問題を引き起こす可能性があるかどうかは場合によります。このようなことが起こる一つの方法は、ダンプファイルから画像フラグフィールドを読み込むが、ダンプファイルのボックスパラメータも使用しない場合です。

LIGGGHTS(R)-PUBLICは、上記で説明したスナップショットの列ラベル（例えば、x、xs、xu、xsu）の非スケールおよび再マッピングされた座標を計算する方法を理解しています。もし別の列ラベルがx、y、またはzフィールドに割り当てられている場合（例えば、[fix ave/atom]()コマンドによって出力された座標など）、その場合、LIGGGHTS(R)-PUBLICはダンプファイル内の座標情報がスケーリングされているか、ラップされているかを認識する必要があります。これは、scaledおよびwrappedキーワードを使って設定できます。labelキーワードがそのフィールドに列ラベルを割り当てていない場合、x、y、またはzフィールドに対するscaledおよびwrappedキーワードの値は無視されることに注意してください。

スケール/非スケールおよびラップ/アンラップの設定は、指定されたx、y、zフィールドのいずれについても一致している必要があります。したがって、ダンプファイルからxsおよびyuを読み込むことはできません。また、ダンプファイルの座標がスケールされており、シミュレーションボックスがトライクリニックの場合、x、y、zの全てのフィールドが指定されていなければなりません。これは、絶対的な非スケール座標を生成するために全てが必要だからです。

## 制限事項
gzippedダンプファイルを読み取るには、LIGGGHTS(R)-PUBLICを「-DLAMMPS_GZIP」オプションでコンパイルする必要があります。詳細は、ドキュメントの「Making LIGGGHTS(R)-PUBLIC」セクションを参照してください。

## 関連コマンド
[dump](), [read_data](), [read_restart](), rerun

## デフォルト
オプションのデフォルト設定は、box = yes、replace = yes、purge = no、trim = no、add = no、scaled = no、wrapped = yes、およびformat = nativeです。
