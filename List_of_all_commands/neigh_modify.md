# neigh_modify command
# neigh_settings command

## 構文
```
neigh_modify keyword values ...
```
1つ以上のキーワード/値ペアをリストできます。

キーワード = delay、every、check、once、include、exclude、page、one、binsize
delay 値 = N
N = 最後のビルドから何ステップ経過してからビルドを遅延させるか

every 値 = M
M = この回数のステップごとに隣接リストをビルド

check 値 = yes または no
yes = 何らかの原子がスキン距離の半分以上移動した場合のみビルド
no = every と delay が満たされた最初のステップで常にビルド

once
yes = シミュレーション開始時に隣接リストを1回だけビルドし、その後再ビルドしない
no = 他の設定に従って隣接リストを再ビルド

include 値 = group-ID
group-ID = このグループ内の原子のみ隣接リストをビルド

exclude 値:
type M N
M, N = 一方の原子が M 型で、もう一方が N 型の場合は除外
group group1-ID group2-ID
group1-ID, group2-ID = 1つ目のグループに属する原子と2つ目のグループに属する原子の場合は除外
molecule group-ID
groupname = 両方の原子が同じ分子かつ同じグループに属する場合は除外
none
すべての除外設定を削除

page 値 = N
N = 1つの隣接ページに保存するペアの数

one 値 = N
N = 1つの原子の最大隣接数

contact_distance_factor 値 = N
N = 粒子の隣接リスト範囲を拡張するために使用される接触距離ファクター（1より大きい必要がある）

binsize 値 = size
size = 隣接リスト構築のためのビンサイズ（距離単位）


```
neigh_settings binsize_value
```

binsize_value = 隣接リスト構築のためのビンサイズ（距離単位）

## 例
```
neigh_modify every 2 delay 10 check yes page 100000
neigh_modify exclude type 2 3
neigh_modify exclude group frozen frozen check no
neigh_modify exclude group residue1 chain3
neigh_modify exclude molecule rigid
neigh_modify delay 0 contact_distance_factor 1.5
neigh_settings
neigh_settings 0.1
```

## 説明
これらのコマンドは、ペアワイズ隣接リストの構築と使用に影響を与えるパラメータを設定します。neigh_settings コマンドは、neigh_modify のラッパーであり、delay*=0 を設定します。その唯一のオプションのパラメータは、*binsize の値として解釈されます（下記参照）。

every、delay、check、および once オプションは、シミュレーションの進行に伴いリストがどれくらいの頻度で構築されるかに影響を与えます。delay 設定は、前回の構築から少なくとも N ステップが経過するまで新しいリストを構築しないことを意味します。every 設定は、リストを M ステップごとに構築することを意味します（delay が過ぎた後）。check 設定が no の場合、リストは delay と every 設定を満たす最初のステップで構築されます。check 設定が yes の場合、リストは、前回の構築から原子がスキン距離の半分以上移動した場合にのみ構築されます。once 設定が yes の場合、隣接リストは各実行の開始時に一度だけ構築され、その後は再構築されません。これを行うのは、原子が十分に動かないことが確実な場合のみ行うべきです（例：冷却された結晶のシミュレーション）。隣接リストが再構築されるべきかを確認するのは、それほど高コストではないことに注意してください。

rRESPA インテグレーターが使用されている場合（[run_style]() コマンドを参照）、every と delay のパラメータは最長（最外周）のタイムステップに関連します。

contact_distance_factor 設定は、粒状隣接リストの範囲を増加させるために使用できます。contact_distance_factor > 1.0 の場合、標準の基準である ri + rj + skin < distance の代わりに、LIGGGHTS(R)-PUBLIC は contact_distance_factor * (ri + rj) + skin < distance を使って、粒子ペアが隣接リストに入るかどうかを判定します。

include オプションは、ペアワイズ隣接リストの構築を指定されたグループ内の原子に限定します。これは、シミュレーションの大部分が他の粒子やペアワイズ相互作用を通じて相互作用しない粒子で構成されているモデルで役立ちます。このオプションで指定されたグループは、[atom_modify first]() コマンドでも指定する必要があります。

exclude オプションは、特定の原子ペア間のペアワイズ相互作用をオフにし、それらを隣接リストに含めないようにします。これが有用なシナリオの例をいくつか挙げます：

- クラックシミュレーションでは、2つの原子スラブ間でペアワイズ相互作用をオフにすることで、実質的にクラックを作成できます。
- 多くの原子が凍結された状態で扱われている場合、その原子間の相互作用をオフにすることで不要な計算を省けます。例えば、[fix setforce]() コマンドを使用して壁や生体分子の一部を凍結する場合です。
- 1つまたは複数の剛体が指定されている場合、各剛体内の相互作用をオフにすることで不要な計算を省けます。詳細については、[fix rigid]() コマンドを参照してください。

exclude type オプションは、1つの原子がタイプ M で、もう1つの原子がタイプ N の場合にペアワイズ相互作用をオフにします。M は N と等しくても構いません。exclude group オプションは、1つの原子が最初のグループにあり、もう1つの原子が2番目のグループにある場合に相互作用をオフにします。group1-ID は group2-ID と等しくても構いません。exclude molecule オプションは、両方の原子が指定されたグループ内で同じ分子に属している場合、相互作用をオフにします（分子IDに基づいて決定されます）。

exclude オプションの各種は複数回指定することができます。exclude type オプションは最も効率的なオプションで、指定回数に関係なく、1回のチェックで済みます。その他の exclude オプションは、複数回指定した場合にコストが高くなり、それぞれの指定に対してチェックが行われます。

なお、exclude オプションはペアワイズ相互作用にのみ影響を与えます。ボンド相互作用をオフにする方法については、[delete_bonds]() コマンドを参照してください。

page と one オプションは、隣接リストのためにメモリがどのように割り当てられるかに影響します。ほとんどのシミュレーションでは、これらのオプションのデフォルト設定で問題ありませんが、非常に大きな問題を実行している場合や非常に長いカットオフを使用している場合は、これらのパラメータを調整することができます。隣接する原子のインデックスは「ページ」に格納され、ページが埋まると次々に新しいページが割り当てられます。各ページのサイズは page 値で設定されます。次の原子の隣接原子がリストをオーバーフローする可能性がある場合、新しいページが割り当てられます。このしきい値は one 値によって設定され、1つの原子が持つことのできる最大隣接原子数をLIGGGHTS(R)-PUBLICに指示します。

[!WARNING]
LIGGGHTS(R)-PUBLICは、1つの粒子に対する隣接粒子の数が page 設定よりも大きい場合（つまり、one 設定よりも遥かに大きい場合）にエラーメッセージなしでクラッシュすることがあります。これは、LIGGGHTS(R)-PUBLICがすべてのペアワイズ相互作用に対してこの制限をエラーチェックしないためです（コストが高すぎるため）、代わりにすべての粒子の隣接粒子が見つかった後にのみチェックを行います。この問題は通常、問題設定（粒子の間隔、カットオフ長、隣接粒子のスキン距離など）に何か非常に問題があることを意味します。もし本当にその数の隣接粒子が1つの粒子に必要だと予想される場合は、one と page 設定を適切に増加させてください。


binsize オプションは、隣接リストの構築で使用されるビンのサイズを指定するためのものです。このビンは、隣接する原子をソートして見つけるために使用されます。デフォルトでは、[neighbor style bin]() の場合、LIGGGHTS(R)-PUBLICはペアカットオフの最大値の1/2のサイズのビンを使用します。[neighbor style multi]() の場合、ビンはペアカットオフの最小値の1/2のサイズになります。通常、これらは隣接リスト構築の時間を最小化するために良い値です。この設定はデフォルト設定を上書きします。ビンサイズを大きくしすぎると、ビンをループするオーバーヘッドは少なくなりますが、より多くの原子がチェックされます。ビンサイズを小さくしすぎると、最適な数の原子がチェックされますが、ビンのオーバーヘッドが増えます。binsize を0.0に設定すると、LIGGGHTS(R)-PUBLICはカットオフの1/2のデフォルトビンサイズを使用します。

## 制限事項
「delay」設定がゼロでない場合、それは「every」設定の倍数でなければなりません。

「exclude molecule」オプションは、分子IDを定義する原子スタイルでのみ使用できます。

「page」設定の値は、「one」設定の10倍以上でなければなりません。これにより、隣接ページがほとんど空のスペースにならないようにします。

## 関連コマンド
[neighbor](), [delete_bonds]()

## デフォルト
オプションのデフォルト値は、delay = 10、every = 1、check = yes、once = no、include = all、exclude = none、page = 100000、one = 2000、binsize = 0.0 です。