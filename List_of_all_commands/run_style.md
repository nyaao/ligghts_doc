# run_style command

## 構文
```
run_style style args
```

- style = verlet または respa の指定が可能です。

verlet 引数:none  
respa 引数:N n1 n2 ... keyword 値 ...  
N = rRESPA（階層的リプル動力学法）のレベル数  
n1, n2, ... = rRESPAレベル間のループファクター（N-1個の値）  
0個以上のキーワード/値ペアをループファクターに追加できます。  

キーワード:  
bond:  
値 = M  
M = ボンド力を計算するレベル（1-N）  

pair:  
値 = M  
M = ペア力を計算するレベル（1-N）  

inner:  
値 = M cut1 cut2  
M = ペア内力を計算するレベル（1-N）  
cut1 = ペア内力とペア中間または外力の間の内カットオフ（距離単位）  
cut2 = ペア内力とペア中間または外力の間の外カットオフ（距離単位）  

middle:  
値 = M cut1 cut2  
M = ペア中間力を計算するレベル（1-N）  
cut1 = ペア中間力とペア外力の間の内カットオフ（距離単位）  
cut2 = ペア中間力とペア外力の間の外カットオフ（距離単位）  

outer:  
値 = M  
M = ペア外力を計算するレベル（1-N）  
これらの設定を使って、rRESPAの複数のレベルで異なる計算を行うことができます。  

## 例
```
run_style verlet
run_style respa 4 2 2 2 bond 1 dihedral 2 pair 3 kspace 4
run_style respa 4 2 2 2 bond 1 dihedral 2 inner 3 5.0 6.0 outer 4 kspace 4
```

## 説明
LIGGGHTS(R)-PUBLICで実行される分子動力学シミュレーションに使用する時間積分器のスタイルを選択します。

verlet スタイルは、標準的な速度Verlet積分器です。

respa スタイルは、rRESPAマルチタイムスケール積分器（Tuckerman, Berne and Martyna, J Chem Phys, 97, p 1990 (1992).）を実装しており、N個の階層レベルを持ちます。レベル1は最も内側のループ（最小のタイムステップ）で、レベルNは最も外側のループ（最大のタイムステップ）です。ループファクター引数は、レベル間でのループ因子を指定します。N1は、レベル2の1回のイテレーションに対してレベル1の繰り返し回数を指定し、N2はレベル3の1回のイテレーションに対してレベル2の繰り返し回数を指定します。その他のN-1個のループパラメータも指定する必要があります。

timestep コマンドは最外層のrRESPAレベルのタイムステップを設定します。したがって、上記の4レベルのrRESPAの例で外層タイムステップが4.0フェムト秒（fmsec）であれば、内層タイムステップはそれの8倍小さい0.5フェムト秒になります。その他のLIGGGHTS(R)-PUBLICコマンド（例えば、[neigh_modify]() パラメータ、[dump]() every N timesteps など）で指定されたタイムステップ数は、最外層のタイムステップを参照します。

rRESPAのキーワードにより、階層のどのレベルで様々な力を計算するかを指定できます。指定しない場合、デフォルトでは、結合力はレベル1（最内層）で計算され、角度力は結合力が計算される場所で、二面角力は角度力が計算される場所で、不正角力は二面角力が計算される場所で、対（ペア）力は最外層で計算され、kspace力は対力が計算される場所で計算されます。inner、middle、outerの力にはデフォルトはありません。

inner と middle のキーワードは、ペアワイズ力計算で使用されるカットオフを指定する追加の引数を取ります。例えば、inner の2つのカットオフが5.0と6.0の場合、6.0以内の全てのペアは inner 力で計算されます。5.0と6.0の間のペアは、次の領域（middle または outer）との重なりが滑らかになるように力が0.0に段階的に減少します。次の領域（middle または outer）は、5.0以降の全てのペアに対して力を計算し、5.0から6.0の間のペアには逆方向で値が段階的に変化します。

一部のペアポテンシャルのみが inner、middle、outer キーワードの使用をサポートしています。サポートしていない場合、そのペアスタイルでは pair キーワードのみを使用でき、すべてのペアワイズ力が同じrRESPAレベルで計算されます。詳細については、個別のペアスタイルに関するドキュメントページを参照してください。

rRESPA（または任意のMDシミュレーション）を使用する際には、選択したアンサンブルのハミルトニアンが保存されることを確認するために、タイムステップのサイズを適切に選ぶことが重要です。定常NVEアンサンブルの場合、総エネルギーは保存されなければなりません。残念ながら、エネルギーがどの程度保存されるかを事前に知ることは難しく、パラメータの試行セットでエネルギーの長期的なドリフトが発生しないことを確認するために、通常はかなり長いテストシミュレーション（約10 ps）が必要です。

その前提を踏まえて、respa設定を選択する際に役立ついくつかの経験則があります。以下は主にCHARMMやそれに類似したオールアトム力場を使用した生体分子シミュレーションに適用されますが、この概念は他の問題にも適応可能です。SHAKEを使用しない場合、水素原子を含む結合は高周波の振動を示し、エネルギーを保存するためには0.5フェムト秒（fmsec）程度のタイムステップが必要です。結合、角度、イムプロパー、ジヒードラルの計算は比較的低コストであり、最も内側の0.5fmsecのタイムステップで計算できます。最外のタイムステップは、エネルギードリフトを避けるために4.0fmsecを超えてはなりません。rRESPA階層の各レベル間で力をスムーズに切り替えることもドリフトを防ぐために必要で、1〜2オングストロームの「ヒーリング距離」（内外カットオフ間の距離）が適切に機能します。したがって、SHAKEなしの生体分子シミュレーションでrespaスタイルを使用するための設定として以下の設定を推奨します。

これらの設定を使用すると、ユーザーはエネルギーの保存が良好であり、0.5 fmsecのタイムステップを使用したverletスタイルと比較して約2.5倍の速度向上を期待できます。

```
timestep  4.0
run_style respa 4 2 2 2 inner 2 4.5 6.0 middle 3 8.0 10.0 outer 4
```

## 制限事項
rRESPAを使用する際は、システムの速度と精度のトレードオフを実験し、エネルギーが適切な精度で保存されていることを確認する必要があります。


## 関連コマンド
[timestep](), [run]()

## デフォルト
```
run_style verlet
```