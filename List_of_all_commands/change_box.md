# change_box command

## 構文
```
change_box group-ID parameter args ... keyword args ... force
```

group-ID = 変位させる原子群のグループID
1つ以上のパラメータ/引数のペアを追加できま

```
parameter = x または y または z または xy または xz または yz または boundary または ortho または triclinic または set または remap
x, y, z 引数 = スタイル 値(s)
スタイル = final または delta または scale または volume
final の値 = lo hi
lo hi = 変位後のボックス境界（距離単位）
delta の値 = dlo dhi
dlo dhi = 変位後のボックス境界の変化（距離単位）
scale の値 = factor
factor = 変位後のボックス長さの変化に対する乗数
volume の値 = none = システムの体積を保持するためにこの次元を調整
xy, xz, yz 引数 = スタイル 値
スタイル = final または delta
final の値 = tilt
tilt = 変位後の傾斜係数（距離単位）
delta の値 = dtilt
dtilt = 変位後の傾斜係数の変化（距離単位）
boundary 引数 = x y z
x, y, z = p または s または f または m, 1文字または2文字
p は周期的
f は非周期的で固定
s は非周期的でシュリンクラップ
m は非周期的でシュリンクラップ、最小値付き
ortho 引数 = none = ボックスを直交座標に変更
triclinic 引数 = none = ボックスを三斜め座標に変更
set 引数 = none = 現在のボックスの状態を保存
remap 引数 = none = 最後に保存した状態から現在のボックスへの原子座標の再マッピング
```

ゼロ個以上のキーワード/値のペアを追加できます
keyword = units

```
unitsの値 = lattice または box
lattice = 距離は格子単位で定義されます
box = 距離はシミュレーションボックス単位で定義されます
```
force キーワードを追加できます

## 例
```
change_box all xy final -2.0 z final 0.0 5.0 boundary p p f remap units box
change_box all x scale 1.1 y volume z volume remap
```

## 説明

シミュレーションボックスの体積、形状、および境界条件を変更します。直交型（Orthogonal）シミュレーションボックスは、3つの調整可能なサイズパラメータ（x, y, z）を持ちます。トリクリニック型（非直交型）シミュレーションボックスは、6つの調整可能なサイズ/形状パラメータ（x, y, z, xy, xz, yz）を持ちます。これらのパラメータはこのコマンドによって独立して調整できます。したがって、ボックスを拡張または縮小したり、非直交型ボックスにせん断ひずみを加えたりするために使用できます。また、シミュレーションボックスの境界条件を変更するためにも使用できます。これは、[boundary]()コマンドと似た動作をします。

初期のシミュレーションボックスのサイズと形状は、シミュレーションを設定するために使用された[create_box]()、[read_data]()、または[read_restart]()コマンドによって指定されます。その後、fix nptや[fix deform]()コマンドなどを使用して、サイズや形状を変更することができます。[create_box]()、[read_data]()、および[read_restart]()コマンドは、シミュレーションボックスが直交型かトリクリニック型かを決定し、xy、xz、yzの傾斜因子の意味を解説するドキュメントページも提供しています。

LIGGGHTS(R)-PUBLICで定義されたトリクリニックボックスの幾何学的な説明と、これらのパラメータを他の一般的なトリクリニック表現に変換する方法については、ドキュメントのSection_howto 12を参照してください。

このコマンドで使用されるキーワードは、指定された順序でシミュレーションボックスとその中の原子に順次適用されます。

キーワードのシーケンスが呼び出される前に、現在のボックスサイズ/形状が保存され、remapキーワードが使用された場合に、以前に保存されたボックスサイズ/形状から現在のものに原子座標をマッピングできるようになります。

すべてのキーワードが処理された後、シミュレーションボックスの境界が変更される可能性があるシュリンクラップ境界条件（[boundary]()コマンド参照）が呼び出され、原子は新しいオーナープロセッサに移動されます。

[!WARNING]
以前の「displace_box」コマンドとは異なり、このコマンドではデフォルトで原子のリマッピングは行われません。このコマンドでは、リマッピングをより汎用的に実行できるようになり、変換のシーケンス内で指定した正確なタイミングで実行できます。そのため、remapキーワードを使用しない場合、ボックスのサイズや形状が変更されても原子の座標は変更されません。一様なひずみ状態を望む場合は、remapキーワードを指定する必要があります。

[!WARNING]
このコマンドを使用すると、原子が失われる可能性があります。例えば、ボックスを変更しても原子をリマッピングしない場合、原子が非周期境界の外側に出てしまうことがあります。また、境界を周期的から非周期的に変更することで、境界をまたぐ原子間の結合が不適切に変更される場合もあります。さらに、原子をリマッピングする際に、原子が（ほぼ）重なってしまうこともあります。例えば、非周期的境界を周期的境界に変更する場合などです。これらの状況は通常、悪い動力学を引き起こしたり、エラーメッセージが生成されたりする原因となります。

[!WARNING]
このコマンドにより、シミュレーションボックスのサイズや形状を任意の大きさまで変更することができます。これは特に問題ではありませんが、シミュレーションボックスへのプロセッサのマッピングは初期の3次元構成のまま変更されない点に注意が必要です（[processors]()コマンドを参照）。そのため、ボックスのサイズや形状が大幅に変更された場合、初期のマッピングで試みられた最適なマッピングとは異なり、プロセッサとシミュレーションボックスのマッピングが最適でなくなる可能性があります。

[!WARNING]
このコマンドで使用されるキーワードは、シミュレーションボックスおよびその中の原子に対して1つずつ順番に適用されるため、変換の各段階で三斜晶セル（triclinic cell）の傾き（skew）の制限を超えないよう注意が必要です。最終的な変換の前に傾きが制限を超える場合、シーケンスの順序を変更するか、変換を2回以上の小さい変換に分けることで回避できます。ボックスの傾きに関する許容限界の詳細については、このページの三斜晶ボックスに関する議論を参照してください。



x、y、z のパラメータに関して、それぞれのスタイルと値の意味は以下の通りです。

スタイル final: ある次元の最終的な lo（下限）および hi（上限）のボックス境界を指定します。値は、格子（lattice）単位またはボックス（box）距離単位で指定できます。単位に関する詳細は、以下の「units」キーワードの説明を参照してください。

スタイル delta: ある次元の lo/hi ボックス境界の増減をプラスまたはマイナスで指定します。値は、格子単位またはボックス距離単位で指定できます。単位に関する詳細は、以下の「units」キーワードの説明を参照してください。

スタイル scale: ある次元のボックス長に適用する乗算係数を指定します。例えば、初期のボックス長が 10 で、係数が 1.1 の場合、最終的なボックス長は 11 になります。1.0 未満の係数は圧縮を意味します。

スタイル volume は、指定された次元を、直前のキーワードによって行われた操作に対して全体のボックス体積が一定に保たれるように変更します。スタイル volume は、ボリュームを変更したキーワード、すなわち x、y、z のいずれかに続いてのみ使用できます。もし直前のキーワード「key」に スタイル volume が指定されていた場合、それと現在のキーワードは、さらにその前のキーワードに適用されます。つまり、以下のようなキーワードの連続は許可されます。
```
change_box all x scale 1.1 y volume z volume
```

スタイル volume は、関連する次元を変更して、直前のキーワードが適用される前のボックス全体の体積が変更されないようにします。

以下のコマンドが使用された場合、z方向のボックスの長さは、x方向のボックスの長さが増加したのと同じ 1.1 の係数で縮小します。
```
change_box all x scale 1.1 z volume
```

以下のコマンドが使用された場合、y および z のボックスの長さは、それぞれ
$\sqrt{1.1}$で縮小し、体積を一定に保ちます。この場合、y および z のボックスの長さは、相対的なアスペクト比を一定に保つように縮小されます。
```
change_box all"x scale 1.1 y volume z volume
```

以下のコマンドが使用された場合、最終的なボックスの寸法は以下のように変更され、体積は一定に保たれます：x および y のボックス長がそれぞれ 10% 増加、z のボックス長が 21% 減少
```
change_box all x scale 1.1 z volume y scale 1.1 z volume
```

[!WARNING]固体や液体の場合、ボックスの1つの次元を拡大した際に、他の2つのボックス長を固定するのは物理的に不適切な場合があります。これは、密度が変化することを意味するからです。特に固体では、他の次元を volume スタイルを用いて調整することは（液体と同様に）物理的に意味があるかもしれませんが、ポアソン比が0.5ではない材料やポテンシャルに対しては正確ではない可能性があります。


スケールおよび体積スタイルの場合、ボックス長はその中央を基準にして拡張または圧縮されます。

xy、xz、およびyzパラメータについて、これらのスタイルと値の意味は以下の通りです。なお、トリクリニックボックスの傾斜因子を変更しても、ボックスの体積は変更されません。

スタイル final では、最終的な傾斜因子が指定されます。その値は格子またはボックス距離単位で指定できます。単位キーワードの説明については、以下を参照してください。


これらのスタイルはすべて、xy、xz、yzの傾斜因子を変更します。LIGGGHTS(R)-PUBLICでは、トリクリニックボックスの傾斜因子（xy、xz、yz）は、並行するボックスの長さの半分を超えてはいけません。たとえば、xlo = 2 および xhi = 12 の場合、xのボックス長は10であり、xy傾斜因子は-5から5の間でなければなりません。同様に、xzおよびyzも -(xhi-xlo)/2 から +(yhi-ylo)/2 の間でなければなりません。これは制限ではなく、たとえば最大傾斜因子が5の場合、傾斜因子が...、-15、-5、5、15、25、... のような構成はすべて同等であるためです。このコマンドで指定された任意の傾斜因子は、これらの制限内でなければなりません。

boundary キーワードは、[boundary]() コマンドと全く同じ意味を持つ引数を取ります。各次元で、単一の文字を指定すると、ボックスの下部と上部の両面に同じスタイルが適用されます。2文字を指定すると、最初のスタイルが下部の面に、2番目のスタイルが上部の面に適用されます。

スタイル p はボックスが周期的であることを意味します。その他のスタイルは非周期的であることを意味します。スタイル f では、面の位置は固定されます。スタイル s では、その次元で原子を囲むように面の位置が設定され（シュリンクラッピング）、原子がどれだけ動いても面は動きません。スタイル m では、シュリンクラッピングが行われますが、その次元の現在のボックスのエッジで制約されるため、ボックスは小さくなることはありません。これらのスタイルオプションの詳細については、[boundary]() コマンドの説明を参照してください。

[boundary]()コマンド自体は、シミュレーションボックスが[read_data]()または[create_box]()または[read_restart]()コマンドを使って定義される前にのみ使用できます。このコマンドは、後で入力スクリプト内で境界条件を変更することを可能にします。また、[read_restart]()は再起動ファイルに保存された内容に合わせて境界条件を変更します。もし境界条件を変更したい場合は、[read_restart]()コマンドの後に[change_box]()コマンドを使用する必要があります。

orthoおよびtriclinicキーワードは、シミュレーションボックスを直交（orthogonal）または三角形（triclinic、非直交）に変換します。非直交ボックスがLIGGGHTS(R)-PUBLICでどのように表現されているかについては、このセクションを参照してください。

シミュレーションボックスは、[create_box]()、[read_data]()、[read_restart]()コマンドを使用して作成される際に、直交（orthogonal）または三角形（triclinic）として定義されます。

これらのキーワードは、既存のシミュレーションボックスを直交から三角形、またはその逆に切り替えることを可能にします。例えば、最初の平衡化シミュレーションを直交ボックスで実行し、その後ボックスを三角形に切り替えることができます。

もしシミュレーションボックスが現在三角形であり、xy、yz、またはxz方向に非ゼロの傾斜（tilt）がある場合、そのボックスは直交ボックスに変換することはできません。

setキーワードは現在のボックスのサイズ/形状を保存します。これは、remapキーワードを複数回使用したい場合や、キーワード操作の一連の中で中間のボックスサイズ/形状に適用したい場合に便利です。ボックスのサイズ/形状は、いかなるキーワードが処理される前に保存されることに注意してください。つまり、[create_box]()コマンドが入力スクリプトで遭遇した時点でのボックスサイズ/形状が保存されます。

remapキーワードは、最後に保存されたボックスのサイズ/形状から現在のボックス状態に原子座標を再マッピングします。例えば、x方向にボックスを引き伸ばしたり、xy平面でボックスを傾けたりした場合、remapコマンドは、原子がボックスの変形に合わせて移動したかのように、原子を新しいボックスのサイズ/形状に合わせて引き伸ばしたり、傾けたりします。

remapキーワードは、最後に保存されたボックスのサイズ/形状から現在のボックス状態に原子座標を再マッピングします。例えば、x方向にボックスを引き伸ばしたり、xy平面でボックスを傾けたりする場合、remapコマンドは原子を新しいボックスのサイズ/形状に合わせて引き伸ばしたり傾けたりします。これは、ボックスが変形する際に原子がボックスと一緒に移動したかのように行われます。

この操作は周期境界に関係なく実行されることに注意してください。また、非周期境界のシュリンクラッピング（[boundary]()コマンド参照）は、このキーワードを含むすべてのキーワードが処理された後に行われます。

指定されたグループの原子のみが再マッピングされます。


unitsキーワードは、さまざまな引数を定義するために使用される距離単位の意味を決定します。box値は、[units]()コマンドで定義された標準的な距離単位を選択します。例えば、units = realやmetalの場合、距離単位はアンストロームです。lattice値は、距離単位が格子間隔であることを意味します。格子間隔は、事前に[lattice]()コマンドを使用して定義されている必要があります。

[change_box]()コマンドは、リスタートデータを含むfixを持つ再開したシミュレーションには使用できません。これを回避するために、forceキーワードを使用することができます。ただし、これはLIGGGHTS(r)が1つのプロセッサで実行されている場合にのみ機能します。

## 制限事項
orthoまたはtriclinicキーワードを使用する場合、このコマンドが入力スクリプトで実行される時点では、[dumps]()や[fix ave/spatial]()、[fix deform]()はアクティブにできません。これは、これらのコマンドが最初に発行される時に、シミュレーションボックスが直交型（orthogonal）かどうかを確認するためです。なお、これらのコマンドは、change_boxコマンドが発行される前にスクリプトで使用することはできますが、その場合、[undump]()や[unfix]()コマンドを使ってそれらを無効にする必要があります。

## 関連コマンド
[fix deform](), [boundary]()

## デフォルト
デフォルトでは、units = box が設定されます。