# fix ave/atom command

# 構文
```
fix ID group-ID ave/atom Nevery Nrepeat Nfreq value1 value2 ...
```

- ID と group-ID は [fix]() コマンドのドキュメントに記載されています。
- ave/atom = この fix コマンドのスタイル名
- Nevery = 指定したタイムステップごとに入力値を使用
- Nrepeat = 平均を計算するために入力値を使用する回数
- Nfreq = 指定したタイムステップごとに平均を計算,1つ以上の入力値を指定可能です。
- value = 以下のいずれかを指定：

x, y, z, vx, vy, vz, fx, fy, fz = 原子属性（位置、速度、力の成分）  
c_ID = 指定した ID の compute コマンドで計算された per-atom ベクトル  
c_ID[I] = 指定した ID の compute コマンドで計算された per-atom 配列の I 列目  
f_ID = 指定した ID の fix コマンドで計算された per-atom ベクトル  
f_ID[I] = 指定した ID の fix コマンドで計算された per-atom 配列の I 列目  
v_name = 指定した名前の atom-style 変数によって計算された per-atom ベクトル  

# 例
```
fix 1 all ave/atom 1 100 100 vx vy vz
fix 1 all ave/atom 10 20 1000 c_my_stress[1]
```

# 説明
いくつかのタイムステップごとに1つ以上の per-atom ベクトルを入力として使用し、より長い時間スケールで原子ごとに平均を計算します。このようにして得られた per-atom 平均は、[fix ave/spatial]() や [dump custom ]()といった他の[output commands]()で使用することができます。

このコマンドで指定されたグループは、そのグループ内の原子のみが平均計算の対象となることを意味します。グループに含まれない原子については、結果は 0.0 に設定されます。

各入力値は、原子属性（位置、速度、力の成分）であるか、[compute]() や [fix]() の結果、または atom-style [variable]()の評価結果である必要があります。後者の場合、compute、fix、または変数は per-atom ベクトルを生成しなければなりません。グローバル量やローカル量は使用できません。グローバル量を時間平均したい場合は、[fix ave/time]() コマンドを参照してください。

per-atom ベクトルや配列を生成する [compute]() は、そのスタイル名に「atom」という単語を含んでいます。個々の [fix]() のドキュメントページを確認すると、どのコマンドが per-atom ベクトルや配列を生成するかを判断できます。また、atom スタイルの変数のみがこの fix コマンドで使用できます。これらの変数は per-atom ベクトルを生成します。

各入力ベクトルの各 per-atom 値は独立して平均されます。

Nevery、Nrepeat、Nfreq の引数は、平均値の算出に寄与するために入力値がどのタイムステップで使用されるかを指定します。最終的な平均値は、Nfreq の倍数であるタイムステップで生成されます。平均は、シミュレーションの直前の部分で Nevery タイムステップごとに計算された Nrepeat 個の値に基づいて行われます。Nfreq は Nevery の倍数でなければならず、Nrepeat が 1 であっても Nevery は 0 ではない必要があります。また、平均値の計算に寄与するタイムステップが重複してはならないため、Nfreq > (Nrepeat-1)*Nevery の条件を満たす必要があります。

例えば、Nevery=2、Nrepeat=6、Nfreq=100 の場合、タイムステップ 90、92、94、96、98、100 の値が、タイムステップ 100 での最終的な平均値を計算するために使用されます。同様に、タイムステップ 190、192、194、196、198、200 の値が、タイムステップ 200 での平均値の計算に使用されます。

原子属性値（x, y, z, vx, vy, vz, fx, fy, fz）は明白なものです。その他の原子属性をこの fix の入力として使用する場合は、[compute property/atom]() コマンドを使用し、その compute の出力値を指定してください。

[!WARNING]x, y, z 属性は、原子が周期境界を越えるたびに周期ボックス内で再ラップされる値です。そのため、周期ボックスの両側で半分ずつ時間を過ごす原子を時間平均すると、ボックスの中央にある値が得られます。これが望む結果でない場合は、[compute property/atom]() コマンドの xu、yu、zu 属性を使用して提供される「アンラップされた座標」を平均することを検討してください。

値が「c_」で始まる場合、その後にスクリプト内で事前に定義された compute ID が続く必要があります。括弧付きの項が追加されていない場合は、compute が計算した per-atom ベクトルが使用されます。括弧付きの項にインデックス I が含まれている場合、compute によって計算された per-atom 配列の第 I 列が使用されます。また、ユーザーは独自の compute スタイル用コードを作成し、それを LIGGGHTS(R)-PUBLIC に追加することもできます。

値が「f_」で始まる場合、その後にスクリプト内で事前に定義された fix ID が続く必要があります。括弧付きの項が追加されていない場合は、fix が計算した per-atom ベクトルが使用されます。括弧付きの項にインデックス I が含まれている場合、fix によって計算された per-atom 配列の第 I 列が使用されます。ただし、一部の fix は特定のタイムステップでのみ値を生成するため、これが Nevery と互換性がない場合はエラーが発生します。ユーザーは独自の fix スタイル用コードを作成し、それを LIGGGHTS(R)-PUBLIC に追加することも可能です。

値が「v_」で始まる場合、その後にスクリプト内で事前に定義された変数名が続く必要があります。この変数は [atom-style variable]()として定義されている必要があります。atom-style 変数は、評価時に熱力学キーワードを参照したり、他の compute、fix、または変数を呼び出したりできるため、per-atom 量を生成して時間平均を取る非常に汎用的な手段となります。

[!NOTE]

# Restart, fix_modify, output, run start/stop, minimize info
この fix に関する情報は[binary restart file]()には書き込まれません。また、この fix に関連する [fix_modify]() オプションは存在しません。この fix は、さまざまな出力コマンドでアクセス可能なグローバルスカラーやベクトル量を保持しません。

この fix は、さまざまな[output commands]()によってアクセス可能な、per-atom ベクトルまたは配列を生成します。単一の量が平均化される場合はベクトルが生成されます。2つ以上の量が平均化される場合は、値の配列が生成されます。per-atom 値は、平均化が実行される Nfreq の倍数のタイムステップでのみアクセス可能です。

この fix のパラメータは、run コマンドの start/stop キーワードと一緒に使用することはできません。また、この fix はエネルギー最小化中に呼び出されることはありません。

# 制限事項
none

# 関連コマンド
[compute](), [fix ave/histo](), [fix ave/spatial](), [fix ave/time](), [variable](),

# デフォルト
none