# fix addforce command

# 構文
```
fix ID group-ID addforce fx fy fz keyword value ...
```
- ID、group-ID は fix コマンドで説明されています。
- addforce = この fix コマンドのスタイル名
- fx, fy, fz = 力の成分値（力の単位）

fx, fy, fz のいずれかは変数で指定可能（下記参照）


- 引数には任意の数のキーワード/値のペアを追加できます。
- キーワード = region または energy

region の値 = region-ID  
region-ID = 力を加えるために原子が属している必要がある領域のID  
energy の値 = v_name  
v_name = 追加された力場内の各原子のポテンシャルエネルギーを計算する変数  

# 例
```
fix kick flow addforce 1.0 0.0 0.0
fix kick flow addforce 1.0 0.0 v_oscillate
fix ff boundary addforce 0.0 0.0 v_push energy v_espace
```

# 説明
fx, fy, fz をグループ内の各原子の力の対応する成分に追加します。このコマンドは、例えばチャネル内でのポアズイユ流のシミュレーションのように、シミュレーション内の原子に追加の力を加えるために使用できます。

力の成分を定義する3つの量のいずれかは、equal-style または atom-style の[variable]()として指定できます。具体的には、fx, fy, fz です。もし値が変数の場合、その変数は v_name として指定する必要があります。この場合、変数は毎タイムステップで評価され、その値が力の成分を決定するために使用されます。

equal-style 変数は、さまざまな数学的関数を用いた式を指定することができ、シミュレーションボックスのパラメータやタイムステップ、経過時間に関連する [thermo_style]() コマンドのキーワードも含まれます。このため、時間依存の力場を簡単に指定できます。

atom-style 変数は、equal-style 変数と同じ式を指定できるほか、原子座標などの原子ごとの値も含むことができます。これにより、空間的に依存した力場を時間依存性を伴って指定することも簡単にできます。

[region]() キーワードが使用される場合、指定された幾何学的領域内に原子が存在する必要があり、その場合にのみ力が加えられます。

原子に力を加えることは、適用された力場により原子が移動することによってそのポテンシャルエネルギーが変化することを意味します。run コマンドによる動力学の場合、このエネルギーはオプションでシステムのポテンシャルエネルギーに加算され、熱力学的出力に反映されます（下記参照）。minimize コマンドによるエネルギー最小化の場合、このエネルギーはシステムのポテンシャルエネルギーに加算され、自己整合的な最小化問題を形成する必要があります（下記参照）。

もし加えられる力が定数ベクトル $F=(fx,fy,fz)$ で、すべての成分が数値定数として定義され、変数ではない場合、energy キーワードは使用できません。これは、LIGGGHTS(R)-PUBLIC が各原子に対するエネルギーを直接計算できるためです。エネルギーは $E=−x⋅F=−(x⋅fx+y⋅fy+z⋅fz)$ として計算され、これにより $−Grad(E)=F$ となります。

energy キーワードは、加えられる力が1つ以上の変数で定義され、かつ [run]() コマンドによる動力学が実行されている場合にはオプションです。もしこのキーワードが使用されない場合、LIGGGHTS(R)-PUBLIC はエネルギーを 0.0 に設定しますが、動力学の場合は通常これで問題ありません。

energy キーワードは、加えられる力が1つ以上の変数で定義され、かつエネルギー最小化を minimize コマンドで実行している場合に必要です。このキーワードは、各原子のエネルギーを位置の関数として計算するために使用される [atom-style variable]()の名前を指定します。fx, fy, fz に使用される変数と同様に、エネルギー変数は v_name として指定され、name は変数名です。

エネルギー最小化中に energy キーワードを使用する場合、原子スタイル変数に定義された数式が力変数の数式と一致していることを確認する必要があります。つまり、$−Grad(E)=F$ である必要があります。例えば、力がバネのような$F=kx$であれば、エネルギーの数式は $E=−0.5kx^2$でなければなりません。これを正しく行わないと、最小化が適切に収束しません。

# Restart, fix_modify, output, run start/stop, minimize info
この修正に関する情報は[binary restart file]()に書き込まれません。

[fix_modify]() energy オプションは、この修正によって加えられた力がシステムのポテンシャルエネルギーに追加され、[thermodynamic output]()の一部として「エネルギー」を加算するためにサポートされています。これは架空の量ですが、minimize コマンドがこの修正によって加えられた力を一貫して取り扱うために必要です。つまり、原子が加えられた力の方向に動くとき、ポテンシャルエネルギーは減少します。

この修正は、グローバルスカラーとグローバル3ベクトルの力を計算し、これらはさまざまな[output commands]()でアクセスできます。スカラーは上記で説明したポテンシャルエネルギーです。ベクトルは、個々の原子に加えられる力がこの修正によって変更される前の原子群に対する総力です。この修正によって計算されたスカラーおよびベクトルの値は「広がりのある（extensive）」ものです。

この修正のパラメータは、[run]() コマンドの start/stop キーワードと共に使用することはできません。

この修正による力はエネルギー最小化中に課せられ、minimize コマンドによって呼び出されます。最小化器と共に使用するために時間依存性を持つ変数で力の成分を指定してはいけません。なぜなら、最小化器は最小化中にイテレーションカウントとしてタイムステップをインクリメントするからです。

[!WARNING]加えられた力に関連する架空のポテンシャルエネルギーをシステムの総ポテンシャルエネルギー（最小化される量）に含めたい場合、この修正に対して fix_modify energy オプションを有効にする必要があります。

# 制限事項
none

コースグレイン情報:
このコマンドとコースグレインを組み合わせて使用すると、異なるダイナミクスやシステム状態が生じ、その結果として不整合が生じる可能性があります。

[!NOTE]
コースグレインは、LIGGGHTS(R)-PUBLIC で利用できる場合とできない場合があります。

関連コマンド
[fix setforce](), [fix aveforce]()

# デフォルト
none