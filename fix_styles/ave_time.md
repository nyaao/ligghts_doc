# fix ave/time command

# 構文
```
fix ID group-ID ave/time Nevery Nrepeat Nfreq value1 value2 ... keyword args ...
```
- ID、group-ID は fix コマンドで記載されています。
- ave/time はこの fix コマンドのスタイル名です。
- Nevery はこの多くのタイムステップごとに入力値を使用する回数を指定します。
- Nrepeat は入力値を平均計算に使用する回数です。
- Nfreq は平均を計算するタイムステップの間隔です。
- 1つまたは複数の入力値を指定できます。
value = c_ID, c_ID[N], f_ID, f_ID[N], v_name

c_ID = IDで計算されたグローバルスカラーまたはベクトル  
c_ID[I] = IDで計算されたグローバルベクトルのI番目の成分またはグローバル配列のI番目の列  
f_ID = IDで計算されたグローバルスカラーまたはベクトル  
f_ID[I] = IDで計算されたグローバルベクトルのI番目の成分またはグローバル配列のI番目の列  
v_name = 名前で指定されたequal-style 変数によって計算されたグローバル値  

- ゼロ個以上のキーワード/引数のペアを追加できます。
- キーワード = mode、file、ave、start、off、overwrite、title1、title2、title3

mode 引数 = scalar または vector  
scalar = すべての入力値はグローバルスカラー  
vector = すべての入力値はグローバルベクトルまたはグローバル配列  
ave 引数 = one または running または window M  
one = Nfreq ステップごとに新しい平均値を出力  
running = すべての前の Nfreq ステップの累積平均を出力  
window M = 最も最近の M 個の Nfreq ステップの平均を出力  
start 引数 = Nstart  
Nstart = このタイムステップから平均化を開始  
off 引数 = M = この値を平均化しない  
M = 1 から Nvalues までの値  
file 引数 = filename  
filename = 時間平均を出力するファイル名  
overwrite 引数 = none  
最新の出力のみで出力ファイルを上書き  
title1 引数 = string  
string = 出力ファイルの1行目に印刷するテキスト  
title2 引数 = string  
string = 出力ファイルの2行目に印刷するテキスト  
title3 引数 = string  
string = 出力ファイルの3行目に印刷するテキスト（vector モードのみ）  

# 例
```
fix 1 all ave/time 100 5 1000 c_myTemp c_myTemp2 file temp.profile
fix 1 all ave/time 100 5 1000 c_myArray[2] ave window 20 &
                              title1 "My output values"
fix 1 all ave/time 1 100 1000 f_indent f_indent[1] file temp.indent off 1
```

# 説明
このコマンドは、いくつかのグローバル値を入力として数ステップごとに使用し、それらを長期間にわたって平均化します。得られた平均値は、[thermo_style custom]() などの他の[output commands]()で使用することができ、ファイルに書き込むこともできます。なお、もし時間平均が行われない場合、このコマンドは単に1つ以上のグローバル値をファイルに出力するための便利な方法として使用できます。

このコマンドで指定されたグループは無視されます。ただし、指定された値は、計算を実行する compute や fix が独自に「グループ」定義を保持している場合があることに注意してください。

リストされた各値は、[compute]() や [fix]() の結果、または equal style [variable]()の評価結果であることができます。この場合、compute、fix、または変数はグローバルな量を生成する必要があり、アトムごとの量やローカルな量であってはいけません。もし、アトムごとの量を空間的または時間的に平均化したり、ヒストグラムを作成したい場合は、[fix ave/spatial]()、[fix ave/atom]()、または [fix ave/histo]() コマンドを参照してください。また、アトムごとの量を単一のグローバル量に合計したい場合は、[compute reduce]() コマンドを参照してください。

グローバルな量を生成する[compute]()は、スタイル名に「atom」の単語が含まれていない計算です。グローバルな量を生成する計算はほんの一部の [fix]() のみです。どの計算がそのような値を生成するかについては、個別の fix のドキュメントページで確認してください。この fix で使用できるのは、equal スタイルの変数のみです。atom スタイルの変数は使用できません。なぜなら、atom スタイルの[variable]()はアトムごとの値を生成するからです。

入力値は、mode キーワードの設定に応じて、すべてスカラーか、すべてベクトル（または配列）でなければなりません。両方の場合で、平均化は各入力値に対して独立して行われます。つまり、各スカラー入力は独立して平均化され、各ベクトル（または配列）の各要素も独立して平均化されます。

もし mode = vector の場合、入力値はベクトルまたは配列である必要があり、すべて同じ「長さ」でなければなりません。ここでの「長さ」とは、ベクトルの長さまたは配列の行数を指します。もしグローバル配列がリストされている場合、それは個別の列を一つずつリストした場合と同じです。例えば、以下の2つの fix ave/time コマンドは等価です。なぜなら、[compute rdf]() コマンドは、この場合、3列でそれぞれ長さ50のグローバル配列を生成するからです：

```
compute myRDF all rdf 50 1 2
fix 1 all ave/time 100 1 100 c_myRDF file tmp1.rdf mode vector
fix 2 all ave/time 100 1 100 c_myRDF[1] c_myRDF[2] c_myRDF[3] file tmp2.rdf mode vector
```

Nevery、Nrepeat、およびNfreqの引数は、入力値が平均値に寄与するために使用されるタイムステップを指定します。最終的な平均化された量は、Nfreqの倍数のタイムステップで生成されます。平均は、シミュレーションの前の部分で、毎Neveryタイムステップごとに計算されたNrepeatの量について行われます。NfreqはNeveryの倍数でなければならず、NeveryはNrepeatが1でもゼロであってはならないことに注意してください。また、平均値に寄与するタイムステップは重複してはいけません。つまり、Nfreq > (Nrepeat - 1) * Nevery という条件が必要です。

例えば、Nevery=2、Nrepeat=6、Nfreq=100の場合、タイムステップ90、92、94、96、98、100の値が使用され、タイムステップ100で最終的な平均が計算されます。同様に、タイムステップ190、192、194、196、198、200ではタイムステップ200で平均が計算されます。もしNrepeat=1でNfreq=100の場合、時間平均は行われません。値は単にタイムステップ100、200、...で生成されます。

値が[c_]()で始まる場合、入力スクリプトで事前に定義されたコンピュートIDが続く必要があります。mode = scalarの場合、角括弧で囲まれた項が追加されていなければ、コンピュートによって計算されたグローバルスカラーが使用されます。角括弧で囲まれた項が追加されている場合、コンピュートによって計算されたグローバルベクトルのI番目の要素が使用されます。mode = vectorの場合、角括弧で囲まれた項が追加されていなければ、コンピュートによって計算されたグローバルベクトルが使用されます。もしコンピュートが配列を計算する場合、その配列のすべての列が個別のベクトルとして指定されたかのように使用されます（上記の説明参照）。角括弧で囲まれた項が追加されている場合、コンピュートによって計算されたグローバル配列のI番目の列が使用されます。

なお、per-atomの量をグローバルスカラーやベクトルに合計して、それをfix ave/timeでアクセスできるようにする[compute reduce]()コマンドがあります。また、入力スクリプトで定義されていないコンピュートでも、[thermodynamic output]()や他のfix（例えばfix nvtやfix temp/rescale）によって定義されることがあります。これらのコマンドに関するドキュメントページを参照すると、これらのコンピュートのIDが記載されています。ユーザーは独自のコンピュートスタイルを作成し、それをLIGGGHTS(R)-PUBLICに追加することもできます。

値[f_]()で始まる場合、入力スクリプトで事前に定義されたfix IDが続く必要があります。mode = scalarの場合、角括弧で囲まれた項が追加されていなければ、fixによって計算されたグローバルスカラーが使用されます。角括弧で囲まれた項が追加されている場合、fixによって計算されたグローバルベクトルのI番目の要素が使用されます。mode = vectorの場合、角括弧で囲まれた項が追加されていなければ、fixによって計算されたグローバルベクトルが使用されます。もしfixが配列を計算する場合、その配列のすべての列が個別のベクトルとして指定されたかのように使用されます（上記の説明参照）。角括弧で囲まれた項が追加されている場合、fixによって計算されたグローバル配列のI番目の列が使用されます。

なお、いくつかのfixは特定のタイムステップでのみその値を生成するため、Neveryと互換性がない場合はエラーが発生します。ユーザーは独自のfixスタイルを作成し、それをLIGGGHTS(R)-PUBLICに追加することもできます。

値が[v_]()で始まる場合、入力スクリプトで事前に定義された変数名が続く必要があります。変数はmode = scalarの場合のみ入力として使用できます。使用できるのはequalスタイルの変数のみです。詳細は[variable]()コマンドを参照してください。なお、equalスタイルの変数は、個々の原子のプロパティや熱力学的キーワードを参照したり、他のcompute、fix、または変数を評価時に呼び出すことができる数式を定義するため、これにより時間平均するための量を指定する非常に一般的な方法となります。

さらに、追加のオプションのキーワードがこのfixの動作に影響を与えます。

modeキーワードがscalarに設定されている場合、すべての入力値はグローバルスカラーまたはグローバルベクトルの要素でなければなりません。modeキーワードがvectorに設定されている場合、すべての入力値はグローバルベクトルまたはグローバル配列の列でなければなりません。また、グローバル配列も使用できますが、その場合は上記で説明したように、各列が個別のグローバルベクトルに変換されます。

aveキーワードは、Nfreqステップごとに生成された値が、Nfreqの倍数である以前のステップで生成された値とどのように平均化されるかを決定します。その後、これらの値は他の出力コマンドによってアクセスされるか、ファイルに書き込まれます。

aveの設定が「one」の場合、Nfreqの倍数であるタイムステップで生成された値は互いに独立しており、追加の平均化を行わずにそのまま出力されます。

aveの設定が「running」の場合、Nfreqの倍数であるタイムステップで生成された値は累積的に合計され、平均化されてから出力されます。したがって、各出力値はそのタイムステップで生成された値と、それ以前のすべての値の平均です。この走行平均はfixが定義された時点から開始され、unfixコマンドでfixを削除するか、fixを再定義することでのみ再開できます。

ave設定が「window」の場合、Nfreqの倍数であるタイムステップで生成された値は、移動する「ウィンドウ」内で合計され、平均化されて出力が生成されます。つまり、最後のM個の値が出力を生成するために使用されます。例えば、M = 3およびNfreq = 1000の場合、ステップ10000での出力はステップ8000、9000、10000での個々の値の平均となります。早いステップでの出力は、M個未満の値で平均化されます。

startキーワードは、平均化が開始されるタイムステップを指定します。デフォルトはステップ0です。通常、入力値はタイムステップ0で0.0となることがあるため、startを大きな値に設定することで、実行中またはウィンドウ平均に0.0を含まないようにすることができます。

offキーワードは、入力値のいずれかにフラグを付けるために使用できます。値がフラグ付けされると、その値は時間平均化されません。代わりに、最も最近の入力値が常に保存され、出力されます。これは、compute、fix、またはvariableによって生成された入力のいずれかが実質的に定数であるか、単に現在の値である場合に役立ちます。例えば、他の時間平均化された値と一緒にファイルに書き出されて、適切なフォーマットで出力を作成する場合です。

fileキーワードを使用すると、ファイル名を指定できます。Nfreqステップごとに、fix ave/timeコマンドで指定された各入力値について、1つの量または量のベクトルがファイルに書き込まれます。mode = scalarの場合、出力が実行されるたびに1行が書き込まれます。したがって、ファイルは数値の列が1つずつ並んだ行の連続となります。mode = vectorの場合、出力が実行されるたびに数値の配列が書き込まれます。行数は入力ベクトルの長さ、列数は値の数です。したがって、ファイルはこれらの配列セクションの連続となります。

overwriteキーワードは、出力ファイルを最新の出力で上書きし続けるため、ファイルには常に1タイムステップ分の出力だけが含まれるようになります。このオプションは、ave running設定でのみ使用できます。

title1、title2、title3キーワードは、出力ファイルの最初の2行または3行に印刷される文字列を指定するために使用されます。fileキーワードが使用された場合、LIGGGHTS(R)-PUBLICはこれらのデフォルト値を使用するため、指定する必要はありません。

デフォルトでは、mode = scalarの場合、これらのヘッダー行は次のようになります：

```
# Time-averaged data for fix ID
# TimeStep value1 value2 ...
```

最初の行では、IDはfix-IDに置き換えられます。2行目では、値はfix ave/timeコマンドからの適切なフィールドに置き換えられます。ファイルのヘッダーには3行目はなく、したがってmode = scalarの場合、title3設定は無視されます。

デフォルトでは、mode = vectorの場合、これらのヘッダー行は次のようになります：

```
# Time-averaged data for fix ID
# TimeStep Number-of-rows
# Row value1 value2 ...
```

最初の行では、IDはfix-IDに置き換えられます。2行目では、出力の各セクションの最初に印刷される2つの値が説明されます。3行目では、値はfix ave/timeコマンドからの適切なフィールドに置き換えられます。

# Restart, fix_modify, output, run start/stop, minimize info
このfixに関する情報は、[binary restart file]()には書き込まれません。このfixに関連する[fix_modify]()オプションはありません。

このfixは、さまざまな[output commands]()によってアクセスできるグローバルスカラー、グローバルベクトル、またはグローバル配列を生成します。値は、平均化が実行されるタイムステップ（Nfreqの倍数）でのみアクセスできます。

スカラーは、単一の入力値が平均化され、mode = scalarの場合に生成されます。ベクトルは、複数の入力値が平均化されるmode = scalarの場合、または単一の入力値がmode = vectorの場合に生成されます。最初のケースでは、ベクトルの長さは入力値の数です。2番目のケースでは、ベクトルの長さは入力ベクトルの長さと同じです。配列は、複数の入力値が平均化され、mode = vectorの場合に生成されます。グローバル配列の行数は入力ベクトルの長さ、列数は入力値の数です。

もしfixがスカラーまたはベクトルを生成する場合、スカラーとベクトルの各要素は「集中的（intensive）」または「広範囲（extensive）」のいずれかです。もしfixが配列を生成する場合、配列のすべての要素は同じでなければなりません。すなわち、すべてが「集中的」または「広範囲」のいずれかです。もしcomputeやfixが時間平均化される値を提供する場合、そのcomputeやfixがその値が集中的か広範囲かを決定します。その詳細については、該当するcomputeやfixのドキュメントページを参照してください。変数によって生成された値は集中的として扱われます。

このfixのパラメータは、[run]()コマンドのstart/stopキーワードと一緒に使用することはできません。このfixはエネルギー最小化中には呼び出されません。

# 制限事項
none

# 関連コマンド
[compute](), [fix ave/atom](), [fix ave/spatial](), [fix ave/histo](), [variable](), [fix ave/correlate](),

# デフォルト
オプションのデフォルト設定は、mode = scalar、ave = one、start = 0、ファイル出力なし、title 1,2,3 = 上記で説明された文字列、そして入力値に対するオフ設定なしです。