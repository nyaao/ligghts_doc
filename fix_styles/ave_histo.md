# fix ave/histo command

# 構文
```
fix ID group-ID ave/histo Nevery Nrepeat Nfreq lo hi Nbin value1 value2 ... keyword args ...
```
- ID、group-IDはfixコマンドで記載されています。
- ave/histo = このfixコマンドのスタイル名
- Nevery = この多くのタイムステップごとに入力値を使用
- Nrepeat = ヒストグラム計算に使用する入力値の回数
- Nfreq = ヒストグラムをこの多くのタイムステップごとに計算
- lo, hi = ヒストグラムの範囲（lo/hi）
- Nbin = ヒストグラムのビン数 1つ以上の入力値をリストできます
- value = x, y, z, vx, vy, vz, fx, fy, fz, c_ID, c_ID[N], f_ID, f_ID[N], v_name 

x, y, z, vx, vy, vz, fx, fy, fz = アトリビュート（位置、速度、力の成分）  
c_ID = 計算によって得られたスカラーまたはベクトル（IDによる）  
c_ID[I] = 計算によって得られたベクトルのI番目の成分または配列のI番目の列（IDによる）  
f_ID = 計算によって得られたスカラーまたはベクトル（fixによる）  
f_ID[I] = fixによって得られたベクトルのI番目の成分または配列のI番目の列  
v_name = equalスタイルまたはatomスタイルの変数で計算された値（名前付き）  

- ゼロ個以上のキーワード/引数のペアを追加できます。
- キーワード = mode または file または ave または start または beyond または overwrite または title1 または title2 または title3

mode 引数 = scalar または vector  
scalar = すべての入力値はスカラー  
vector = すべての入力値はベクトル  
file 引数 = filename  
filename = ヒストグラムを出力するファイル名  
ave 引数 = one または running または window  
one = Nfreq ステップごとに新しい平均値を出力  
running = すべての前の Nfreq ステップの累積平均を出力  
window M = 最も最近の M 個の Nfreq ステップの平均を出力  
start 引数 = Nstart  
Nstart = このタイムステップから平均化を開始  
beyond 引数 = ignore または end または extra  
ignore = ヒストグラムの lo/hi 範囲外の値を無視  
end = ヒストグラムの lo/hi 範囲外の値を最後のビンでカウント  
extra = ヒストグラムの lo/hi 範囲外の値のために 2 つの追加ビンを作成  
overwrite 引数 = none = 出力ファイルを最新の出力で上書き  
title1 引数 = string  
string = 出力ファイルの最初の行に印刷するテキスト  
title2 引数 = string  
string = 出力ファイルの 2 番目の行に印刷するテキスト  
title3 引数 = string  
string = 出力ファイルの 3 番目の行に印刷するテキスト（ベクトルモードの場合のみ）  

# 例
```
fix 1 all ave/histo 100 5 1000 0.5 1.5 50 c_myTemp file temp.histo ave running
fix 1 all ave/histo 100 5 1000 -5 5 100 c_myArray[2] c_myArray[3] title1 "My output values"
fix 1 all ave/histo 1 100 1000 -2.0 2.0 18 vx vy vz mode vector ave running beyond extra
```

# 説明
このコマンドでは、指定された値を一定のタイムステップごとに入力として使用し、それらをヒストグラム化し、さらに長期的なタイムスケールでヒストグラムの平均を計算します。結果として得られるヒストグラムは、他の[output commands]()で使用でき、ファイルにも書き出すことができます。

このコマンドで指定されたグループは、グローバルおよびローカルの入力値には無視されます。原子単位での入力値に対しては、指定されたグループに所属する原子だけがヒストグラムに寄与します。指定されたグループに関係なく、指定された値は、計算を実行する計算式やフィックスによって行われるもので、これらは独自の「グループ」定義を持つことに注意してください。

ヒストグラムは、ヒストグラムのビン内に収まる値の数を単純にカウントするものです。N個のビンが定義され、loとhiの間で均等に間隔が取られます。lo/hiの範囲外に収まる値は、さまざまな方法で扱うことができます。詳しくは、beyondキーワードの説明を参照してください。

各入力値は、原子属性（位置、速度、力の成分）であるか、[compute]()や[fix]()の結果、またはイコールスタイルまたはatom-style [variable]()の評価のいずれかであることができます。入力値のセットは、すべてグローバル、すべて原子単位、またはすべてローカルな量である必要があります。異なる種類の入力（例：グローバルと原子単位の入力）を混ぜることはできません。原子属性は原子単位のベクトル値です。個別の「compute」および「fix」コマンドのドキュメンテーションページを参照して、これらのコマンドが生成する量の種類を確認してください。

入力値は、すべてスカラーまたはすべてベクトル（または配列）である必要があります。これは、modeキーワードの設定によって決まります。

mode = vector の場合、入力値はベクトルまたは配列であることができます。グローバル配列がリストされている場合、それは配列の個々の列を1つずつリストした場合と同じ意味になります。例えば、次の2つの fix ave/histo コマンドは同等です。なぜなら、[compute com/molecule]() コマンドが3列のグローバル配列を作成するからです：
```
compute myCOM all com/molecule
fix 1 all ave/histo 100 1 100 c_myCOM file tmp1.com mode vector
fix 2 all ave/histo 100 1 100 c_myCOM[1] c_myCOM[2] c_myCOM[3] file tmp2.com mode vector
```

このコマンドの出力は、すべての入力値を組み合わせた単一のヒストグラムであり、入力値ごとに1つのヒストグラムが生成されるわけではありません。このフィックスの出力形式の詳細については、以下を参照してください。

Nevery、Nrepeat、およびNfreq引数は、ヒストグラムに貢献するために入力値が使用されるタイムステップを指定します。最終的なヒストグラムは、Nfreqの倍数のタイムステップで生成されます。これは、シミュレーションの前半部分で、Neveryタイムステップごとに計算されたNrepeat個のヒストグラムを平均したものです。NfreqはNeveryの倍数でなければならず、Neveryは1であってもゼロであってはいけません。また、ヒストグラムに貢献するタイムステップは重複しない必要があります。すなわち、Nfreq > (Nrepeat-1)*Neveryである必要があります。

例えば、Nevery=2、Nrepeat=6、Nfreq=100の場合、タイムステップ90、92、94、96、98、100の入力値が使われて、タイムステップ100で最終的なヒストグラムが計算されます。同様に、タイムステップ190、192、194、196、198、200でタイムステップ200のヒストグラムが計算されます。もしNrepeat=1、Nfreq=100であれば、ヒストグラムはタイムステップ100、200、...で単純に生成され、時間平均は行われません。

原子属性の値（x, y, z, vx, vy, vz, fx, fy, fz）は説明が明白です。その他の原子属性をこのフィックスの入力として使用する場合は、[compute property/atom]() コマンドを使用し、その計算結果から入力値を指定することができます。

もし値が「c_」で始まる場合、入力スクリプトで以前に定義された計算IDが続かなければなりません。mode = scalar の場合、括弧付きの項が付いていない場合は、計算によって得られたグローバルスカラーが使用されます。括弧付きの項が付いている場合、計算によって得られたグローバルベクトルのI番目の要素が使用されます。mode = vector の場合、括弧付きの項が付いていない場合は、計算によって得られたグローバル、または原子ごとの、またはローカルベクトルが使用されます。もし計算が配列を計算する場合、その配列のすべての列が、個別のベクトルとして指定されたかのように使用されます（上記の説明を参照）。括弧付きの項が付いている場合、計算によって得られたグローバル、または原子ごとの、またはローカル配列のI番目の列が使用されます。

[compute reduce]() コマンドがあり、これを使用することで、原子ごとの量をグローバルスカラーまたはベクトルに合計し、fix ave/histo でアクセスできるようにすることができます。また、入力スクリプトに定義されていない計算であっても、[thermodynamic output]()や他のフィックス（例：fix nvt や fix temp/rescale）によって定義された計算が使用される場合もあります。これらのコマンドに関する詳細は、これらの計算のIDが記載されているドキュメントページを参照してください。ユーザーは独自の計算スタイルを作成し、LIGGGHTS(R)-PUBLICに追加することもできます。

もし値が「f_」で始まる場合、入力スクリプトで以前に定義されたフィックスIDが続かなければなりません。mode = scalar の場合、括弧付きの項が付いていない場合は、フィックスによって計算されたグローバルスカラーが使用されます。括弧付きの項が付いている場合、フィックスによって計算されたグローバルベクトルのI番目の要素が使用されます。mode = vector の場合、括弧付きの項が付いていない場合は、フィックスによって計算されたグローバル、原子ごとの、またはローカルベクトルが使用されます。また、フィックスが配列を計算する場合、その配列のすべての列が、個別のベクトルとして指定されたかのように使用されます（上記の説明を参照）。括弧付きの項が付いている場合、フィックスによって計算されたグローバル、原子ごとの、またはローカル配列のI番目の列が使用されます。

一部のフィックスは特定のタイムステップでのみ値を生成するため、そのタイムステップが Nevery と互換性がある必要があります。互換性がない場合、エラーが発生します。ユーザーは独自のフィックススタイルのコードを作成し、LIGGGHTS(R)-PUBLICに追加することもできます。

もし値が「v_」で始まる場合、入力スクリプトで以前に定義された変数名が続かなければなりません。mode = scalar の場合、使用できるのは equal スタイルの変数のみで、これらはグローバルな値を生成します。mode = vector の場合、使用できるのは atom スタイルの変数のみで、これらは原子ごとのベクトルを生成します。詳細は variable コマンドを参照してください。なお、equal スタイルと atom スタイルの変数は、個々の原子のプロパティや熱力学的なキーワードを参照したり、他の計算、フィックス、変数を評価する際に呼び出すことができるため、ヒストグラムに指定する量を非常に一般的に定義する方法となります。


このフィックスの動作には、追加のオプショナルなキーワードも影響を与えます。

mode キーワードが scalar に設定されている場合、すべての入力値はグローバルスカラーであるか、グローバルベクトルの要素でなければなりません。mode キーワードが vector に設定されている場合、すべての入力値はグローバル、原子ごと、またはローカルベクトルであるか、グローバル、原子ごと、またはローカル配列の列でなければなりません。

beyond キーワードは、lo から hi の範囲外にある入力値がどのように扱われるかを決定します。lo <= value <= hi の値は1つのビンに割り当てられます。ビン境界上の値は、2つのビンのうち低い方のビンに割り当てられます。beyond が ignore に設定されている場合、lo より小さい値と hi より大きい値は無視され、すなわちビンに割り当てられません。beyond が end に設定されている場合、lo より小さい値は最初のビンにカウントされ、hi より大きい値は最後のビンにカウントされます。beyond が extend に設定されている場合、2つの追加ビンが作成され、ビンの総数は Nbins+2 となります。lo より小さい値は最初のビンにカウントされ、hi より大きい値は最後のビン (Nbins+1) にカウントされます。lo と hi の間の値 (含む) は、ビン 2 から Nbins+1 にカウントされます。これら2つの追加ビンの「座標」は lo と hi となります。

ave キーワードは、Nfreq の倍数のタイムステップで生成されたヒストグラムが、他の出力コマンドでアクセスされたりファイルに書き込まれる前に、前のタイムステップで生成されたヒストグラムとどのように平均化されるかを決定します。

ave の設定が one の場合、Nfreq の倍数のタイムステップで生成されたヒストグラムは互いに独立しており、そのまま出力され、さらに平均化は行われません。

ave の設定が running の場合、Nfreq の倍数のタイムステップで生成されたヒストグラムは、出力される前に累積的に合計されて平均化されます。つまり、ヒストグラムの各ビンの値は、そのタイムステップで生成されたビンの値と、同じビンに対するすべての前の値の平均になります。この累積平均は、フィックスが定義された時点から始まります；それは [unfix]() コマンドでフィックスを削除するか、フィックスを再定義して再指定することによってのみ再起動できます。

ave 設定が window の場合、Nfreq の倍数のタイムステップで生成されたヒストグラムは、移動する「ウィンドウ」内で合計され、最後の M 個のヒストグラムが出力を生成するために使用されます。例えば、M = 3 で Nfreq = 1000 の場合、ステップ 10000 の出力は、ステップ 8000、9000、10000 の各タイムステップでの個別のヒストグラムを組み合わせたものになります。初期のステップでの出力は、M 個未満のヒストグラムの合計になることがあります。

start キーワードは、ヒストグラムを開始するタイムステップを指定します。デフォルトはステップ 0 です。多くの場合、タイム 0 では入力値が 0.0 であることがあるため、start を大きな値に設定することで、ランニングヒストグラムやウィンドウヒストグラムに 0.0 を含めないようにすることができます。

file キーワードは、ファイル名を指定するために使用されます。Nfreq ステップごとに、1つのヒストグラムがファイルに書き込まれます。これには、タイムステップ、ビンの数、ヒストグラムに貢献した値の総数、ヒストグラムに含まれなかった値の数（beyond キーワード参照）、最小値、および最大値が含まれる先頭行が含まれます。最小/最大値には、ヒストグラムに含まれなかった値も含まれます。その後、各ビンごとに1行がファイルに書き込まれます。各行には、ビン番号、ビンの中心座標（lo と hi の間）、ビン内の値の数、および正規化されたカウントが含まれます。正規化されたカウントは、ビン内のカウントを総カウント（ヒストグラムに含まれなかった値は除外）で割ったものです。このため、すべてのビンで正規化された値の合計は 1.0 になります。

overwrite キーワードは、出力ファイルを最新の出力で上書きし続けるため、ファイルには常に1つのタイムステップ分の出力のみが含まれます。このオプションは、ave running 設定でのみ使用できます。

title1、title2、title3 キーワードは、file キーワードが使用された場合に、出力ファイルの最初の3行に印刷される文字列を指定するために使用されます。LIGGGHTS(R)-PUBLIC は、各タイトルにデフォルト値を使用するため、これらを指定する必要はありません。

デフォルトでは、これらのヘッダー行は次のようになります：

```
# Histogram for fix ID
# TimeStep Number-of-bins Total-counts Missing-counts Min-value Max-value
# Bin Coord Count Count/Total
```

最初の行では、ID は fix-ID に置き換えられます。2行目では、各出力セクションの最初に印刷される6つの値が説明されます。3行目では、ヒストグラムの各ビンに対して印刷される4つの値が説明されます。

# Restart, fix_modify, output, run start/stop, minimize info
この fix に関する情報は、[binary restart file]()には書き込まれません。この fix に関連する [fix_modify]() オプションはありません。

この fix は、さまざまな[output commands]()によってアクセスできるグローバルベクトルおよびグローバル配列を生成します。これらの値には、ヒストグラムが生成されるタイムステップの倍数でのみアクセスできます。グローバルベクトルには4つの値が含まれます：

- 1=ヒストグラムの総カウント数
- 2=ヒストグラムに含まれなかった値（beyond キーワード参照）
- 3=ヒストグラムに含まれたすべての入力値の最小値（ヒストグラムに含まれなかった値も含む）
- 4=ヒストグラムに含まれたすべての入力値の最大値（ヒストグラムに含まれなかった値も含む）

グローバル配列には、行数が Nbins、列数が 3 です。最初の列にはビンの座標が、2 番目の列にはそのヒストグラムビン内の値のカウント数が、3 番目の列にはビンのカウント数を総カウント数（欠損カウントを含まない）で割った値が含まれます。そのため、3 番目の列の値の合計は 1.0 になります。

この fix によって計算されたベクトルおよび配列の値はすべて「集積的（intensive）」として扱われます。もしそうでない場合（例えば、各原子の入力値をヒストグラム化する場合など）、この fix によって生成された値を解釈する際にその点を考慮する必要があります。

この fix のパラメータは、run コマンドの start / stop キーワードと一緒に使用することはできません。この fix はエネルギー最小化中には呼び出されません。

# 制限事項
none

# 関連コマンド
[compute](), [fix ave/atom](), [fix ave/spatial](), [fix ave/time](), [variable](), [fix ave/correlate](),

# デフォルト
オプションのデフォルトは以下の通りです：

- mode = scalar
- ave = one
- start = 0
- ファイル出力なし
- beyond = ignore
- title 1,2,3 = 上記のように記述された文字列